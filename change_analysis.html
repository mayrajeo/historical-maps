<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Janne M채yr채">
<meta name="dcterms.date" content="2023-02-27">

<title>Monitoring land cover changes using historical maps - Change analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./postprocessings.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<meta property="og:title" content="Monitoring land cover changes using historical maps - Change analysis">
<meta property="og:description" content="After post-processing the results, we used them do derive land use and land cover changes for our study area.">
<meta property="og:site-name" content="Monitoring land cover changes using historical maps">
<meta name="twitter:title" content="Monitoring land cover changes using historical maps - Change analysis">
<meta name="twitter:description" content="After post-processing the results, we used them do derive land use and land cover changes for our study area.">
<meta name="twitter:creator" content="@mayrajeo">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Monitoring land cover changes using historical maps</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mayrajeo/historical-maps/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Change analysis</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Workflow</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./crop_and_georeference.html" class="sidebar-item-text sidebar-link">Crop and georeference old maps</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./color_extraction.html" class="sidebar-item-text sidebar-link">Extracting colors with simple thresholding</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./make_masks.html" class="sidebar-item-text sidebar-link">Create reference masks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./train_model.html" class="sidebar-item-text sidebar-link">Train model</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./postprocessings.html" class="sidebar-item-text sidebar-link">Predictions and postprocessings</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./change_analysis.html" class="sidebar-item-text sidebar-link active">Change analysis</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#wrangle-and-clip-topographic-databases" id="toc-wrangle-and-clip-topographic-databases" class="nav-link active" data-scroll-target="#wrangle-and-clip-topographic-databases"><span class="toc-section-number">1</span>  Wrangle and clip topographic databases</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="toc-section-number">1.1</span>  2005</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="toc-section-number">1.2</span>  2022</a></li>
  </ul></li>
  <li><a href="#change-analyses" id="toc-change-analyses" class="nav-link" data-scroll-target="#change-analyses"><span class="toc-section-number">2</span>  Change analyses</a>
  <ul class="collapse">
  <li><a href="#fields-1" id="toc-fields-1" class="nav-link" data-scroll-target="#fields-1"><span class="toc-section-number">2.1</span>  Fields</a></li>
  <li><a href="#mires-1" id="toc-mires-1" class="nav-link" data-scroll-target="#mires-1"><span class="toc-section-number">2.2</span>  Mires</a></li>
  <li><a href="#roads-1" id="toc-roads-1" class="nav-link" data-scroll-target="#roads-1"><span class="toc-section-number">2.3</span>  Roads</a></li>
  <li><a href="#watercourses-1" id="toc-watercourses-1" class="nav-link" data-scroll-target="#watercourses-1"><span class="toc-section-number">2.4</span>  Watercourses</a></li>
  <li><a href="#water-bodies-1" id="toc-water-bodies-1" class="nav-link" data-scroll-target="#water-bodies-1"><span class="toc-section-number">2.5</span>  Water bodies</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mayrajeo/historical-maps/blob/main/nbs/change_analysis.ipynb" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Change analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Janne M채yr채 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 27, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> colors</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> fiona</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio <span class="im">import</span> features</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.enums <span class="im">import</span> Resampling</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>tqdm.pandas()</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After post-processing the results, we used them do derive land use and land cover changes for our study area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>study_area <span class="op">=</span> gpd.read_file(<span class="st">'../data/studyarea.geojson'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mtk_path <span class="op">=</span> Path(<span class="st">'../data/mtk/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="wrangle-and-clip-topographic-databases" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Wrangle and clip topographic databases</h1>
<section id="section" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="section"><span class="header-section-number">1.1</span> 2005</h2>
<p>Topographic database from 2005 is split into map sheets, and each of those contain several <code>shp</code> files. Our study is fully covered in four map sheets, <code>M21O4D</code>, <code>M2104C</code>, <code>M20O2B</code> and <code>M20O2A</code>. In addition, this dataset is in <code>EPSG:2393</code> coordinates so it must be converted to <code>EPSG:3067</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sheets <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> os.listdir(mtk_path<span class="op">/</span><span class="st">'2005'</span>) <span class="cf">if</span> os.path.isdir(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span>s)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fields" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="fields"><span class="header-section-number">1.1.1</span> Fields</h3>
<p>Fields are found on files with template <code>M&lt;sheetid&gt;P</code>, and the class id is <code>32611</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> <span class="va">None</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> sheets:</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span>s<span class="op">/</span><span class="ss">f'M</span><span class="sc">{</span>s[<span class="dv">1</span>:]<span class="sc">}</span><span class="ss">P.SHP'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp[temp.LUOKKA <span class="op">==</span> <span class="dv">32611</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fields <span class="kw">is</span> <span class="va">None</span>: fields <span class="op">=</span> temp</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: fields <span class="op">=</span> pd.concat([fields, temp])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> fields.to_crs(<span class="st">'EPSG:3067'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> fields.clip(study_area.iloc[<span class="dv">0</span>].geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fields.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fields.to_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span><span class="st">'fields.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mires" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="mires"><span class="header-section-number">1.1.2</span> Mires</h3>
<p>Mires are found on files with template <code>M&lt;sheetid&gt;P</code>, and the class ids are <code>35411</code>, <code>35412</code>, <code>35421</code> and <code>35422</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mires <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> sheets:</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span>s<span class="op">/</span><span class="ss">f'M</span><span class="sc">{</span>s[<span class="dv">1</span>:]<span class="sc">}</span><span class="ss">P.SHP'</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp[temp.LUOKKA.isin([<span class="dv">35411</span>,<span class="dv">35412</span>,<span class="dv">35421</span>,<span class="dv">35422</span>])]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mires <span class="kw">is</span> <span class="va">None</span>: mires <span class="op">=</span> temp</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: mires <span class="op">=</span> pd.concat([mires, temp])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mires <span class="op">=</span> mires.to_crs(<span class="st">'EPSG:3067'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mires <span class="op">=</span> mires.clip(study_area.iloc[<span class="dv">0</span>].geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mires.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-11-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mires[<span class="st">'geometry'</span>] <span class="op">=</span> mires.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: row[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">type</span>(row) <span class="op">!=</span> Polygon <span class="cf">else</span> row)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mires.to_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span><span class="st">'mires.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="roads" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="roads"><span class="header-section-number">1.1.3</span> Roads</h3>
<p>Roads are found on files with template <code>L&lt;sheetid&gt;V</code>, and the class ids are <code>12111</code>, <code>12112</code>, <code>12121</code>, <code>12122</code>, <code>12131</code> and <code>12132</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> sheets:</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span>s<span class="op">/</span><span class="ss">f'L</span><span class="sc">{</span>s[<span class="dv">1</span>:]<span class="sc">}</span><span class="ss">V.SHP'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp[temp.LUOKKA.isin([<span class="dv">12111</span>,<span class="dv">12112</span>,<span class="dv">12121</span>,<span class="dv">12122</span>,<span class="dv">12131</span>,<span class="dv">12132</span>])]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> roads <span class="kw">is</span> <span class="va">None</span>: roads <span class="op">=</span> temp</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: roads <span class="op">=</span> pd.concat([roads, temp])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> roads.to_crs(<span class="st">'EPSG:3067'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> roads.clip(study_area.iloc[<span class="dv">0</span>].geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>roads.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>roads.to_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span><span class="st">'roads.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="watercourses" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4" class="anchored" data-anchor-id="watercourses"><span class="header-section-number">1.1.4</span> Watercourses</h3>
<p>Watercourses are found from files with template <code>M&lt;sheetid&gt;V</code> with class ids <code>36311</code> and <code>36312</code> as line geometries, and from files with template <code>M&lt;sheetid&gt;P</code> with class ids <code>36313</code> as polygon data. As our predictions convert all watercourses into line data, we do the same for class <code>36313</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>watercourses <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> sheets:</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span>s<span class="op">/</span><span class="ss">f'M</span><span class="sc">{</span>s[<span class="dv">1</span>:]<span class="sc">}</span><span class="ss">V.SHP'</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp[temp.LUOKKA.isin([<span class="dv">36311</span>,<span class="dv">36312</span>])]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> watercourses <span class="kw">is</span> <span class="va">None</span>: watercourses <span class="op">=</span> temp</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: watercourses <span class="op">=</span> pd.concat([watercourses, temp])</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>watercourses.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> centerline.geometry <span class="im">import</span> Centerline</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>watercoursepolys <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> sheets:</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span>s<span class="op">/</span><span class="ss">f'M</span><span class="sc">{</span>s[<span class="dv">1</span>:]<span class="sc">}</span><span class="ss">P.SHP'</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp[temp.LUOKKA.isin([<span class="dv">36313</span>])]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> watercoursepolys <span class="kw">is</span> <span class="va">None</span>: watercoursepolys <span class="op">=</span> temp</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: watercoursepolys <span class="op">=</span> pd.concat([watercoursepolys, temp])</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>watercoursepolys.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>watercoursepolys <span class="op">=</span> watercoursepolys.to_crs(<span class="st">'EPSG:3067'</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>watercoursepolys <span class="op">=</span> watercoursepolys.clip(study_area.iloc[<span class="dv">0</span>].geometry)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>watercoursepolys[<span class="st">'geometry'</span>] <span class="op">=</span> watercoursepolys.progress_apply(<span class="kw">lambda</span> row: Centerline(row.geometry), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>watercourses <span class="op">=</span> watercourses.to_crs(<span class="st">'EPSG:3067'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>watercourses <span class="op">=</span> watercourses.clip(study_area.iloc[<span class="dv">0</span>].geometry)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>watercourses <span class="op">=</span> pd.concat([watercourses, watercoursepolys])</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>watercourses.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>watercourses.plot(column<span class="op">=</span><span class="st">'LUOKKA'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>watercourses.to_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span><span class="st">'watercourses.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="water-bodies" class="level3" data-number="1.1.5">
<h3 data-number="1.1.5" class="anchored" data-anchor-id="water-bodies"><span class="header-section-number">1.1.5</span> Water bodies</h3>
<p>Water bodies area on files with template <code>M&lt;sheetid&gt;P</code>, class ids are <code>36200</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>waterbodies <span class="op">=</span> <span class="va">None</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> sheets:</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span>s<span class="op">/</span><span class="ss">f'M</span><span class="sc">{</span>s[<span class="dv">1</span>:]<span class="sc">}</span><span class="ss">P.SHP'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp[temp.LUOKKA.isin([<span class="dv">36200</span>])]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> waterbodies <span class="kw">is</span> <span class="va">None</span>: waterbodies <span class="op">=</span> temp</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: waterbodies <span class="op">=</span> pd.concat([waterbodies, temp])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>waterbodies <span class="op">=</span> waterbodies.to_crs(<span class="st">'EPSG:3067'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>waterbodies <span class="op">=</span> waterbodies.clip(study_area.iloc[<span class="dv">0</span>].geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>waterbodies.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>waterbodies.to_file(mtk_path<span class="op">/</span><span class="st">'2005'</span><span class="op">/</span><span class="st">'waterbodies.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="section-1" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="section-1"><span class="header-section-number">1.2</span> 2022</h2>
<p>Topographic database from 2022 is saved as a single geodatabases for whole Finland, and the databases are:</p>
<ul>
<li>MTK-kallio contains rocks and mineral soils</li>
<li>MTK-korkeussuhteet contains altitude information</li>
<li>MTK-maastokuvionreuna contains the edges for some classes</li>
<li>MTK-muut contains the miscillaneous classes, such as meadows and arable land</li>
<li>MTK-rakennus contains buildings</li>
<li>MTK-suo contains mires</li>
<li>MTK-tie contains the road networks</li>
<li>MTK-vakavesi contains all water bodies</li>
<li>MTK-virtavesi contains all watercourses</li>
</ul>
<p>Our analyses require the usage of <code>MTK-muut</code>, <code>MTK-suo</code>, <code>MTK-tie</code>, <code>MTK-vakavesi</code> and <code>MTK-virtavesi</code>. The class ids are the same as in 2005, and the clipping is done beforehand with QGIS. We just convert watercourse polygons to lines and combine them with watercourse lines.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2022/virtavesiviivat_2022.geojson'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>polys <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2022/virtavesialueet_2022.geojson'</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>polys[<span class="st">'geometry'</span>] <span class="op">=</span> polys.geometry.progress_apply(Centerline)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>wws <span class="op">=</span> pd.concat([lines, polys])</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>wws.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>wws.to_file(mtk_path<span class="op">/</span><span class="st">'2022/virtavedet_2022.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="change-analyses" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Change analyses</h1>
<p>Change analyses can be done with either raster data or polygon data. Working with polygon data is much easier, as newer topographical databases are also polygon data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> polygonize(fn, outpath, target_class, scale_factor<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(fn) <span class="im">as</span> src:</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> src.read(out_shape<span class="op">=</span>(src.count, <span class="bu">int</span>(src.height<span class="op">*</span>scale_factor),<span class="bu">int</span>(src.width<span class="op">*</span>scale_factor)),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                      resampling<span class="op">=</span>Resampling.mode)[target_class <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        im[im <span class="op">!=</span>  <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> im <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        tfm <span class="op">=</span> src.transform <span class="op">*</span> src.transform.scale((src.width<span class="op">/</span>im.shape[<span class="op">-</span><span class="dv">1</span>]), (src.height<span class="op">/</span>im.shape[<span class="op">-</span><span class="dv">2</span>]))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> ({<span class="st">'properties'</span>: {<span class="st">'raster_val'</span>: v}, <span class="st">'geometry'</span>: s}</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">for</span> i, (s, v) <span class="kw">in</span> <span class="bu">enumerate</span>(features.shapes(im, mask<span class="op">==</span>mask, transform<span class="op">=</span>tfm))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span> v <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> fiona.<span class="bu">open</span>(outpath, <span class="st">'w'</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                        crs<span class="op">=</span><span class="st">'EPSG:3067'</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                        schema<span class="op">=</span>{<span class="st">'properties'</span>: [(<span class="st">'raster_val'</span>, <span class="st">'int'</span>)],</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'geometry'</span>: <span class="st">'Polygon'</span>}) <span class="im">as</span> dst:</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            dst.writerecords(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Also, as the maps are not perfectly aligned, the analysis is done by aggregating the data into a rectangular grid.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_grid(area, cell):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    xmin, ymin, xmax, ymax <span class="op">=</span> area.total_bounds</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> <span class="bu">list</span>(np.arange(xmin, xmax<span class="op">+</span>cell, cell))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> <span class="bu">list</span>(np.arange(ymin, ymax<span class="op">+</span>cell, cell))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    polys <span class="op">=</span> []</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    names <span class="op">=</span> []</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (C,x), (R,y) <span class="kw">in</span> product(<span class="bu">enumerate</span>(cols[:<span class="op">-</span><span class="dv">1</span>]), <span class="bu">enumerate</span>(rows[:<span class="op">-</span><span class="dv">1</span>])):</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        polys.append(Polygon([(x,y), (x<span class="op">+</span>cell, y), (x<span class="op">+</span>cell,y<span class="op">+</span>cell),(x, y<span class="op">+</span>cell)]))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        names.append(<span class="ss">f'R</span><span class="sc">{</span>R<span class="sc">}</span><span class="ss">C</span><span class="sc">{</span>C<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gpd.GeoDataFrame({<span class="st">'geometry'</span>:polys, <span class="st">'cellid'</span>:names}, crs<span class="op">=</span>area.crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>respath <span class="op">=</span> Path(<span class="st">'../results/processed/'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> os.listdir(respath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fields-1" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="fields-1"><span class="header-section-number">2.1</span> Fields</h2>
<p>First polygonize the results.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>polypath <span class="op">=</span> Path(<span class="st">'../results/polygons/'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> results:</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    polygonize(respath<span class="op">/</span>r, polypath<span class="op">/</span><span class="st">'fields'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">1</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then put them into a single dataframe</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fields_65 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fields_80s <span class="op">=</span> <span class="va">None</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> os.listdir(polypath<span class="op">/</span><span class="st">'fields'</span>):</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    union_gdf <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'fields'</span><span class="op">/</span>p)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'1965'</span> <span class="kw">in</span> p:</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fields_65 <span class="kw">is</span> <span class="va">None</span>: fields_65 <span class="op">=</span> union_gdf</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: fields_65 <span class="op">=</span> pd.concat((fields_65, union_gdf))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fields_80s <span class="kw">is</span> <span class="va">None</span>: fields_80s <span class="op">=</span> union_gdf</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: fields_80s <span class="op">=</span> pd.concat((fields_80s, union_gdf))</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>fields_65 <span class="op">=</span> fields_65.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>fields_80s <span class="op">=</span> fields_80s.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>fields_65.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>fields_80s.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Save the dataframes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fields_65.to_file(polypath<span class="op">/</span><span class="st">'fields_65.geojson'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fields_80s.to_file(polypath<span class="op">/</span><span class="st">'fields_80s.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fields_05 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005/fields.geojson'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>fields_22 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2022/pellot_2022.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fields_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Fields 1965, total_area </span><span class="sc">{</span>(fields_65.area.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>fields_80s.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Fields 1984-1985, total_area </span><span class="sc">{</span>(fields_80s.area.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>fields_05.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Fields 2005, total_area </span><span class="sc">{</span>(fields_05.area.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>fields_22.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Fields 2022, total_area </span><span class="sc">{</span>(fields_22.area.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>From 1965 to 2022, the total field area has decreased by around 30 km짼. However, visualizing where the change has been most significant is rather difficult from the polygon data, so we aggregate the data into 500x500m grid.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> aggregate_area_to_grid(grid, polys, column_name):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    tempgrid <span class="op">=</span> grid[[<span class="st">'cellid'</span>, <span class="st">'geometry'</span>]].copy()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    tempgrid <span class="op">=</span> tempgrid.overlay(polys, how<span class="op">=</span><span class="st">'intersection'</span>).dissolve(by<span class="op">=</span><span class="st">'cellid'</span>).reset_index(drop<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    tempgrid[column_name] <span class="op">=</span> tempgrid.geometry.area <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> grid.merge(tempgrid[[<span class="st">'cellid'</span>, column_name]], how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span><span class="st">'cellid'</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> make_grid(study_area, <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, fields_65, <span class="st">'field_area_65'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, fields_80s, <span class="st">'field_area_85'</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, fields_05, <span class="st">'field_area_05'</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, fields_22, <span class="st">'field_area_22'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">10</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>grid.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'field_area_65'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'1965'</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'field_area_85'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'1984-1985'</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'field_area_05'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'2005'</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'field_area_22'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'2022'</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Quantify the change. Negative change means decreased field area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'field_change_6585'</span>] <span class="op">=</span> (grid.field_area_85 <span class="op">-</span> grid.field_area_65)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'field_change_8505'</span>] <span class="op">=</span> (grid.field_area_05 <span class="op">-</span> grid.field_area_85)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'field_change_0522'</span>] <span class="op">=</span> (grid.field_area_22 <span class="op">-</span> grid.field_area_05)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Change stats for 1965-1985:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.field_change_6585 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>field_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.field_change_6585 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>field_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>field_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 2.32 km짼
Loss: 14.20 km짼
Change: -11.87 km짼</code></pre>
</div>
</div>
<p>Change stats for 1985-2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.field_change_8505 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>field_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.field_change_8505 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>field_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>field_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 1.27 km짼
Loss: 12.85 km짼
Change: -11.57 km짼</code></pre>
</div>
</div>
<p>Change stats for 2005-2022</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.field_change_0522 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>field_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.field_change_0522 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>field_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>field_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 1.81 km짼
Loss: 5.51 km짼
Change: -3.70 km짼</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>), dpi<span class="op">=</span><span class="dv">200</span>, gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.05</span>]})</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'field_change_6585'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'field_change_8505'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>])</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'field_change_0522'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>])</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="ss">f'1965-1985, total change </span><span class="sc">{</span>grid<span class="sc">.</span>field_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="ss">f'1985-2005, total change </span><span class="sc">{</span>grid<span class="sc">.</span>field_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>].set_title(<span class="ss">f'2005-2022, total change </span><span class="sc">{</span>grid<span class="sc">.</span>field_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> colors.Normalize(vmin<span class="op">=-</span><span class="fl">.2</span>,vmax<span class="op">=</span><span class="fl">.2</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">'seismic'</span>, norm<span class="op">=</span>norm)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> [<span class="op">-</span><span class="fl">.2</span>,<span class="op">-</span><span class="fl">.1</span>,<span class="dv">0</span>,<span class="fl">.1</span>,<span class="fl">.2</span>]</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(sm, cax<span class="op">=</span>axs[<span class="dv">3</span>], ticks<span class="op">=</span>ticks)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>cbar.ax.set_yticklabels([<span class="ss">f'</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss"> km짼'</span> <span class="cf">for</span> t <span class="kw">in</span> ticks])</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Changes in field area, aggregated to 500x500m grid'</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Visualize the location where the field area has decreased the most between 1965 and 1985. For 1965 and 1980s show the corresponding map patch along with the data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.windows <span class="im">import</span> from_bounds</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_map_patch(bbox, year, map_path):</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Get map patch to go along with the desired location"</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year <span class="op">==</span> <span class="dv">1965</span>: files <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(map_path) <span class="cf">if</span> <span class="st">'1965'</span> <span class="kw">in</span> f]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: files <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(map_path) <span class="cf">if</span> <span class="st">'1965'</span> <span class="kw">not</span> <span class="kw">in</span> f]</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> rio.<span class="bu">open</span>(map_path<span class="op">/</span>f) <span class="im">as</span> src:</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            tot_bounds <span class="op">=</span> src.bounds</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> bbox.within(box(<span class="op">*</span>tot_bounds)): <span class="cf">continue</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> src.read(window<span class="op">=</span>from_bounds(<span class="op">*</span>bbox.bounds, src.transform))</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.moveaxis(data, <span class="dv">0</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For 2005 and 2022, show the closest aerial image to that year. Unfortunately the closest historical images available are from 1949 and 1979, so we cant really use them for visualizations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> owslib.wcs <span class="im">as</span> wcs</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_wcs_img(bounds, year):</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    mml_wcs_url <span class="op">=</span> <span class="st">'https://beta-karttakuva.maanmittauslaitos.fi/ortokuvat-ja-korkeusmallit/wcs/v1'</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    mml_wcs <span class="op">=</span> wcs.WebCoverageService(mml_wcs_url)<span class="co">#, version='2.0.1')</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    orig_year <span class="op">=</span> year</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    tries <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> year <span class="op">&lt;</span> <span class="dv">2009</span>: layer <span class="op">=</span> <span class="st">'ortokuva_mustavalko'</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: layer <span class="op">=</span> <span class="st">'ortokuva_vari'</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        img_rgb <span class="op">=</span> mml_wcs.getCoverage(identifier<span class="op">=</span>[layer],</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>                                      crs<span class="op">=</span><span class="st">'EPSG:3067'</span>,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>                                      subsets<span class="op">=</span>[(<span class="st">'E'</span>, bounds[<span class="dv">0</span>], bounds[<span class="dv">2</span>]), </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>                                               (<span class="st">'N'</span>, bounds[<span class="dv">1</span>], bounds[<span class="dv">3</span>]), </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>                                               (<span class="st">'time'</span>, <span class="ss">f'</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">-12-31T00:00:00.000Z'</span>)],</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>                                      <span class="bu">format</span><span class="op">=</span><span class="st">'image/tiff'</span>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> io.BytesIO(img_rgb.read())</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> rio.<span class="bu">open</span>(image) <span class="im">as</span> src:</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> src.read()</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data.<span class="bu">max</span>() <span class="op">!=</span> data.<span class="bu">min</span>(): <span class="cf">break</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>        tries <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>        year <span class="op">=</span> year <span class="op">-</span> tries <span class="cf">if</span> tries<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> year <span class="op">+</span> tries</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    finalyear <span class="op">=</span> year    </span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.moveaxis(data, <span class="dv">0</span>, <span class="dv">2</span>), finalyear</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>map_path <span class="op">=</span> Path(<span class="st">'../data/maps/aligned_maps/'</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>fieldloss_6585_cellid <span class="op">=</span> grid[grid.field_change_6585 <span class="op">==</span> grid.field_change_6585.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> fieldloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>fields_65.clip(grid[grid.cellid <span class="op">==</span> fieldloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>).set_title(<span class="st">'Fields in 1965'</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> fieldloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>fields_80s.clip(grid[grid.cellid <span class="op">==</span> fieldloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>).set_title(<span class="st">'Fields in 1985'</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> fieldloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> fieldloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-46-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Same for 1985 and 2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fieldloss_8505_cellid <span class="op">=</span> grid[grid.field_change_8505 <span class="op">==</span> grid.field_change_8505.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> fieldloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>fields_80s.clip(grid[grid.cellid <span class="op">==</span> fieldloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>).set_title(<span class="st">'Fields in 1985'</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> fieldloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>fields_05.clip(grid[grid.cellid <span class="op">==</span> fieldloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>).set_title(<span class="st">'Fields in 2005'</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> fieldloss_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> fieldloss_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>And then same visualizations for field area increase.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fieldgain_6585_cellid <span class="op">=</span> grid[grid.field_change_6585 <span class="op">==</span> grid.field_change_6585.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> fieldgain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>fields_65.clip(grid[grid.cellid <span class="op">==</span> fieldgain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>).set_title(<span class="st">'Fields in 1965'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> fieldgain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>fields_80s.clip(grid[grid.cellid <span class="op">==</span> fieldgain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>).set_title(<span class="st">'Fields in 1985'</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> fieldgain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> fieldgain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fieldgain_8505_cellid <span class="op">=</span> grid[grid.field_change_8505 <span class="op">==</span> grid.field_change_8505.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> fieldgain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>fields_80s.clip(grid[grid.cellid <span class="op">==</span> fieldgain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>).set_title(<span class="st">'Fields in 1985'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> fieldgain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>fields_05.clip(grid[grid.cellid <span class="op">==</span> fieldgain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:orange'</span>).set_title(<span class="st">'Fields in 2005'</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> fieldgain_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> fieldgain_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-49-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="mires-1" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="mires-1"><span class="header-section-number">2.2</span> Mires</h2>
<p>Polygonize and put to single <code>geojson</code> files.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> results:</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    polygonize(respath<span class="op">/</span>r, polypath<span class="op">/</span><span class="st">'mires'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">2</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mires_65 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>mires_80s <span class="op">=</span> <span class="va">None</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> os.listdir(polypath<span class="op">/</span><span class="st">'mires'</span>):</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    union_gdf <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'mires'</span><span class="op">/</span>p)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'1965'</span> <span class="kw">in</span> p:</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mires_65 <span class="kw">is</span> <span class="va">None</span>: mires_65 <span class="op">=</span> union_gdf</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: mires_65 <span class="op">=</span> pd.concat((mires_65, union_gdf))</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mires_80s <span class="kw">is</span> <span class="va">None</span>: mires_80s <span class="op">=</span> union_gdf</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: mires_80s <span class="op">=</span> pd.concat((mires_80s, union_gdf))</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>mires_65 <span class="op">=</span> mires_65.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>mires_80s <span class="op">=</span> mires_80s.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>mires_65.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>mires_80s.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mires_65.to_file(polypath<span class="op">/</span><span class="st">'mires_65.geojson'</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>mires_80s.to_file(polypath<span class="op">/</span><span class="st">'mires_80s.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mires_05 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005/mires.geojson'</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>mires_22 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2022/suot_2022.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>mires_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Mires 1965, total_area </span><span class="sc">{</span>(mires_65.area.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>mires_80s.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Mires 1984-1985, total_area </span><span class="sc">{</span>(mires_80s.area.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>mires_05.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Mires 2005, total_area </span><span class="sc">{</span>(mires_05.area.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>mires_22.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Mires 2022, total_area </span><span class="sc">{</span>(mires_22.area.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-54-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The difference between the total areas of mires between years can be explained by more accurate mapping methods, or restoration processes.</p>
<p>Put the data into the grid.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, mires_65, <span class="st">'mire_area_65'</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, mires_80s, <span class="st">'mire_area_85'</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, mires_05, <span class="st">'mire_area_05'</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, mires_22, <span class="st">'mire_area_22'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">10</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>grid.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'mire_area_65'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'1965'</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'mire_area_85'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'1984-1985'</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'mire_area_05'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'2005'</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'mire_area_22'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'2022'</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-56-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Quantify the change. Negative change means decreased mire area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'mire_change_6585'</span>] <span class="op">=</span> (grid.mire_area_85 <span class="op">-</span> grid.mire_area_65)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'mire_change_8505'</span>] <span class="op">=</span> (grid.mire_area_05 <span class="op">-</span> grid.mire_area_85)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'mire_change_0522'</span>] <span class="op">=</span> (grid.mire_area_22 <span class="op">-</span> grid.mire_area_05)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Change stats for 1965-1985:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.mire_change_6585 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>mire_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.mire_change_6585 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>mire_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>mire_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 15.86 km짼
Loss: 5.92 km짼
Change: 9.95 km짼</code></pre>
</div>
</div>
<p>Change stats for 1985-2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.mire_change_8505 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>mire_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.mire_change_8505 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>mire_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>mire_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 1.74 km짼
Loss: 8.72 km짼
Change: -6.98 km짼</code></pre>
</div>
</div>
<p>Change stats for 2005-2022</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.mire_change_0522 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>mire_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.mire_change_0522 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>mire_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>mire_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 8.04 km짼
Loss: 1.14 km짼
Change: 6.90 km짼</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>), dpi<span class="op">=</span><span class="dv">200</span>, gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.05</span>]})</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'mire_change_6585'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'mire_change_8505'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>])</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'mire_change_0522'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>])</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="ss">f'1965-1985, total change </span><span class="sc">{</span>grid<span class="sc">.</span>mire_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="ss">f'1985-2005, total change </span><span class="sc">{</span>grid<span class="sc">.</span>mire_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>].set_title(<span class="ss">f'2005-2022, total change </span><span class="sc">{</span>grid<span class="sc">.</span>mire_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> colors.Normalize(vmin<span class="op">=-</span><span class="fl">.2</span>,vmax<span class="op">=</span><span class="fl">.2</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">'seismic'</span>, norm<span class="op">=</span>norm)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> [<span class="op">-</span><span class="fl">.2</span>,<span class="op">-</span><span class="fl">.1</span>,<span class="dv">0</span>,<span class="fl">.1</span>,<span class="fl">.2</span>]</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(sm, cax<span class="op">=</span>axs[<span class="dv">3</span>], ticks<span class="op">=</span>ticks)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>cbar.ax.set_yticklabels([<span class="ss">f'</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss"> km짼'</span> <span class="cf">for</span> t <span class="kw">in</span> ticks])</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Changes in mire area, aggregated to 500x500m grid'</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Visualize the location where the mire area has decreased the most between 1965 and 1985. For 1965 and 1980s show the corresponding map patch along with the data.</p>
<p>For 2005 and 2022, show the closest aerial image to that year. Unfortunately the closest historical images available are from 1949 and 1979, so we cant really use them for visualizations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>mireloss_6585_cellid <span class="op">=</span> grid[grid.mire_change_6585 <span class="op">==</span> grid.mire_change_6585.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> mireloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>mires_65.clip(grid[grid.cellid <span class="op">==</span> mireloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>).set_title(<span class="st">'mires in 1965'</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> mireloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>mires_80s.clip(grid[grid.cellid <span class="op">==</span> mireloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>).set_title(<span class="st">'mires in 1985'</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> mireloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> mireloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>Text(0.5, 1.0, 'Map patch from 1980s')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-62-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Same for 1985 and 2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>mireloss_8505_cellid <span class="op">=</span> grid[grid.mire_change_8505 <span class="op">==</span> grid.mire_change_8505.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> mireloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>mires_80s.clip(grid[grid.cellid <span class="op">==</span> mireloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>).set_title(<span class="st">'mires in 1985'</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> mireloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>mires_05.clip(grid[grid.cellid <span class="op">==</span> mireloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>).set_title(<span class="st">'mires in 2005'</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> mireloss_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> mireloss_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>Text(0.5, 1.0, 'Aerial image from 2008')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-63-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>And then same visualizations for mire area increase.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>miregain_6585_cellid <span class="op">=</span> grid[grid.mire_change_6585 <span class="op">==</span> grid.mire_change_6585.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> miregain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>mires_65.clip(grid[grid.cellid <span class="op">==</span> miregain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>).set_title(<span class="st">'mires in 1965'</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> miregain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>mires_80s.clip(grid[grid.cellid <span class="op">==</span> miregain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>).set_title(<span class="st">'mires in 1985'</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> miregain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> miregain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>Text(0.5, 1.0, 'Map patch from 1980s')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-64-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>miregain_8505_cellid <span class="op">=</span> grid[grid.mire_change_8505 <span class="op">==</span> grid.mire_change_8505.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> miregain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>mires_80s.clip(grid[grid.cellid <span class="op">==</span> miregain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>).set_title(<span class="st">'mires in 1985'</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> miregain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>mires_05.clip(grid[grid.cellid <span class="op">==</span> miregain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:gray'</span>).set_title(<span class="st">'mires in 2005'</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> miregain_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> miregain_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>Text(0.5, 1.0, 'Aerial image from 2008')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-65-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="roads-1" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="roads-1"><span class="header-section-number">2.3</span> Roads</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>road_path <span class="op">=</span> Path(<span class="st">'../results/lines/roads/'</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>roads_65 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>roads_80s <span class="op">=</span> <span class="va">None</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> os.listdir(road_path):</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    union_gdf <span class="op">=</span> gpd.read_file(road_path<span class="op">/</span>p)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'1965'</span> <span class="kw">in</span> p:</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> roads_65 <span class="kw">is</span> <span class="va">None</span>: roads_65 <span class="op">=</span> union_gdf</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: roads_65 <span class="op">=</span> pd.concat((roads_65, union_gdf))</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> roads_80s <span class="kw">is</span> <span class="va">None</span>: roads_80s <span class="op">=</span> union_gdf</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: roads_80s <span class="op">=</span> pd.concat((roads_80s, union_gdf))</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>roads_65 <span class="op">=</span> roads_65[roads_65.geometry.length <span class="op">&gt;</span> <span class="dv">100</span>]</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>roads_80s <span class="op">=</span> roads_80s[roads_80s.geometry.length <span class="op">&gt;</span> <span class="dv">100</span>]       </span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>roads_65 <span class="op">=</span> roads_65.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>roads_80s <span class="op">=</span> roads_80s.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>roads_65.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>roads_80s.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>roads_05 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005/roads.geojson'</span>)</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>roads_22 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2022/tiet_2022.geojson'</span>)</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>roads_22 <span class="op">=</span> roads_22[roads_22.kohdeluokka.isin([<span class="dv">12111</span>,<span class="dv">12112</span>,<span class="dv">12121</span>,<span class="dv">12122</span>,<span class="dv">12131</span>,<span class="dv">12132</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For roads, we can see the overall change in the road networks and approximate total length.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">11</span>,<span class="dv">11</span>))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>roads_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>roads_80s.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>roads_05.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>roads_22.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Roads 1965, total length </span><span class="sc">{</span>roads_65<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Roads 1985, total length </span><span class="sc">{</span>roads_80s<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Roads 2005, total length </span><span class="sc">{</span>roads_05<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Roads 2022, total length </span><span class="sc">{</span>roads_22<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-67-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_len(cell, targs, sindex):</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    nearest_idx <span class="op">=</span> <span class="bu">list</span>(sindex.nearest(cell.geometry.bounds))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    tempdata <span class="op">=</span> targs.iloc[nearest_idx]</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tempdata.clip(cell.geometry, keep_geom_type<span class="op">=</span><span class="va">True</span>).length.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'road_length_65'</span>] <span class="op">=</span> grid.progress_apply(<span class="kw">lambda</span> cell: get_len(cell, roads_65, roads_65.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'road_length_85'</span>] <span class="op">=</span> grid.progress_apply(<span class="kw">lambda</span> cell: get_len(cell, roads_80s, roads_80s.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'road_length_05'</span>] <span class="op">=</span> grid.progress_apply(<span class="kw">lambda</span> cell: get_len(cell, roads_05, roads_05.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'road_length_22'</span>] <span class="op">=</span> grid.progress_apply(<span class="kw">lambda</span> cell: get_len(cell, roads_22, roads_22.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>100%|| 4032/4032 [00:19&lt;00:00, 211.94it/s]
100%|| 4032/4032 [00:19&lt;00:00, 203.38it/s]
100%|| 4032/4032 [00:16&lt;00:00, 249.25it/s]
100%|| 4032/4032 [00:16&lt;00:00, 244.59it/s]</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">10</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>grid.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'road_length_65'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">2.5</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'1965'</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'road_length_85'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">2.5</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'1984-1985'</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'road_length_05'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">2.5</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'2005'</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'road_length_22'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">2.5</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'2022'</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-70-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Quantify the change. Negative change means decreased road length.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'road_change_6585'</span>] <span class="op">=</span> (grid.road_length_85 <span class="op">-</span> grid.road_length_65)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'road_change_8505'</span>] <span class="op">=</span> (grid.road_length_05 <span class="op">-</span> grid.road_length_85)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'road_change_0522'</span>] <span class="op">=</span> (grid.road_length_22 <span class="op">-</span> grid.road_length_05)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Change stats for 1965-1985:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.road_change_6585 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>road_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.road_change_6585 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>road_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>road_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 72.54 km
Loss: 28.55 km
Change: 43.99 km</code></pre>
</div>
</div>
<p>Change stats for 1985-2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.road_change_8505 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>road_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.road_change_8505 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>road_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>road_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 49.61 km
Loss: 13.30 km
Change: 36.31 km</code></pre>
</div>
</div>
<p>Change stats for 2005-2022</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.road_change_0522 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>road_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.road_change_0522 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>road_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>road_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 12.79 km
Loss: 4.24 km
Change: 8.56 km</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>), dpi<span class="op">=</span><span class="dv">200</span>, gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.05</span>]})</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'road_change_6585'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'road_change_8505'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>])</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'road_change_0522'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>])</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="ss">f'1965-1985, total change </span><span class="sc">{</span>grid<span class="sc">.</span>road_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="ss">f'1985-2005, total change </span><span class="sc">{</span>grid<span class="sc">.</span>road_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>].set_title(<span class="ss">f'2005-2022, total change </span><span class="sc">{</span>grid<span class="sc">.</span>road_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> colors.Normalize(vmin<span class="op">=-</span><span class="fl">1.5</span>,vmax<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">'seismic'</span>, norm<span class="op">=</span>norm)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> [<span class="op">-</span><span class="fl">1.5</span>,<span class="op">-</span><span class="fl">0.75</span>,<span class="dv">0</span>,<span class="fl">0.75</span>,<span class="fl">1.5</span>]</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(sm, cax<span class="op">=</span>axs[<span class="dv">3</span>], ticks<span class="op">=</span>ticks)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>cbar.ax.set_yticklabels([<span class="ss">f'</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss"> km'</span> <span class="cf">for</span> t <span class="kw">in</span> ticks])</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Changes in road length, aggregated to 500x500m grid'</span>)</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-75-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Visualize the location where the road length has decreased the most between 1965 and 1985. For 1965 and 1980s show the corresponding map patch along with the data.</p>
<p>For 2005 and 2022, show the closest aerial image to that year. Unfortunately the closest historical images available are from 1949 and 1979, so we cant really use them for visualizations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>map_path <span class="op">=</span> Path(<span class="st">'../data/maps/aligned_maps/'</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>roadloss_6585_cellid <span class="op">=</span> grid[grid.road_change_6585 <span class="op">==</span> grid.road_change_6585.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> roadloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>roads_65.clip(grid[grid.cellid <span class="op">==</span> roadloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:red'</span>).set_title(<span class="st">'roads in 1965'</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> roadloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>roads_80s.clip(grid[grid.cellid <span class="op">==</span> roadloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:red'</span>).set_title(<span class="st">'roads in 1985'</span>)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> roadloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> roadloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-76-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Same for 1985 and 2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>roadloss_8505_cellid <span class="op">=</span> grid[grid.road_change_8505 <span class="op">==</span> grid.road_change_8505.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> roadloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>roads_80s.clip(grid[grid.cellid <span class="op">==</span> roadloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:red'</span>).set_title(<span class="st">'roads in 1985'</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> roadloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>roads_05.clip(grid[grid.cellid <span class="op">==</span> roadloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:red'</span>).set_title(<span class="st">'roads in 2005'</span>)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> roadloss_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> roadloss_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-77-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>And then same visualizations for road length increase.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>roadgain_6585_cellid <span class="op">=</span> grid[grid.road_change_6585 <span class="op">==</span> grid.road_change_6585.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> roadgain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>roads_65.clip(grid[grid.cellid <span class="op">==</span> roadgain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:red'</span>).set_title(<span class="st">'roads in 1965'</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> roadgain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>roads_80s.clip(grid[grid.cellid <span class="op">==</span> roadgain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:red'</span>).set_title(<span class="st">'roads in 1985'</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> roadgain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> roadgain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-78-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>roadgain_8505_cellid <span class="op">=</span> grid[grid.road_change_8505 <span class="op">==</span> grid.road_change_8505.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> roadgain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>roads_80s.clip(grid[grid.cellid <span class="op">==</span> roadgain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:red'</span>).set_title(<span class="st">'roads in 1985'</span>)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> roadgain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>roads_05.clip(grid[grid.cellid <span class="op">==</span> roadgain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:red'</span>).set_title(<span class="st">'roads in 2005'</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> roadgain_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> roadgain_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-79-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="watercourses-1" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="watercourses-1"><span class="header-section-number">2.4</span> Watercourses</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>ww_path <span class="op">=</span> Path(<span class="st">'../results/lines/watercourses/'</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>watercourses_65 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>watercourses_80s <span class="op">=</span> <span class="va">None</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> os.listdir(ww_path):</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    union_gdf <span class="op">=</span> gpd.read_file(ww_path<span class="op">/</span>p)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'1965'</span> <span class="kw">in</span> p:</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> watercourses_65 <span class="kw">is</span> <span class="va">None</span>: watercourses_65 <span class="op">=</span> union_gdf</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: watercourses_65 <span class="op">=</span> pd.concat((watercourses_65, union_gdf))</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> watercourses_80s <span class="kw">is</span> <span class="va">None</span>: watercourses_80s <span class="op">=</span> union_gdf</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: watercourses_80s <span class="op">=</span> pd.concat((watercourses_80s, union_gdf))</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>mires_65 <span class="op">=</span> mires_65.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>mires_80s <span class="op">=</span> mires_80s.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>watercourses_65.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>watercourses_80s.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>watercourses_05 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005/watercourses.geojson'</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>watercourses_22 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2022/virtavedet_2022.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>watercourses_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>, linewidth<span class="op">=</span><span class="fl">.2</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Watercourses 1965, total length </span><span class="sc">{</span>(watercourses_65.length.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>watercourses_80s.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>, linewidth<span class="op">=</span><span class="fl">.2</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Watercourses 1985, total length </span><span class="sc">{</span>(watercourses_80s.length.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>watercourses_05.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>, linewidth<span class="op">=</span><span class="fl">.2</span>)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Watercourses 2005, total length </span><span class="sc">{</span>(watercourses_05.length.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>watercourses_22.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>, linewidth<span class="op">=</span><span class="fl">.2</span>)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Watercourses 2022, total length </span><span class="sc">{</span>(watercourses_22.length.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-81-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Again, to make finding the ditching hotspots easier, aggregate the data into 500x500m grid.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'watercourse_length_65'</span>] <span class="op">=</span> grid.progress_apply(<span class="kw">lambda</span> cell: get_len(cell, watercourses_65, watercourses_65.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'watercourse_length_85'</span>] <span class="op">=</span> grid.progress_apply(<span class="kw">lambda</span> cell: get_len(cell, watercourses_80s, watercourses_80s.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'watercourse_length_05'</span>] <span class="op">=</span> grid.progress_apply(<span class="kw">lambda</span> cell: get_len(cell, watercourses_05, watercourses_05.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'watercourse_length_22'</span>] <span class="op">=</span> grid.progress_apply(<span class="kw">lambda</span> cell: get_len(cell, watercourses_22, watercourses_22.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">12</span>), dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'watercourse_length_65'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">7</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Total length (km) of watercourses in 1965: </span><span class="ch">\n</span><span class="sc">{</span>grid<span class="sc">.</span>watercourse_length_65<span class="sc">.</span><span class="bu">sum</span>() <span class="sc">:.2f}</span><span class="ss">km'</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'watercourse_length_85'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">7</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Total length (km) of watercourses in 1985: </span><span class="ch">\n</span><span class="sc">{</span>grid<span class="sc">.</span>watercourse_length_85<span class="sc">.</span><span class="bu">sum</span>() <span class="sc">:.2f}</span><span class="ss">km'</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'watercourse_length_05'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">7</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Total length (km) of watercourses in 2005: </span><span class="ch">\n</span><span class="sc">{</span>grid<span class="sc">.</span>watercourse_length_05<span class="sc">.</span><span class="bu">sum</span>() <span class="sc">:.2f}</span><span class="ss">km'</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'watercourse_length_22'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">7</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Total length (km) of watercourses in 2022: </span><span class="ch">\n</span><span class="sc">{</span>grid<span class="sc">.</span>watercourse_length_22<span class="sc">.</span><span class="bu">sum</span>() <span class="sc">:.2f}</span><span class="ss">km'</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Length of watercourses in 500x500m grid'</span>)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-83-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Then visualize the changes between the years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'watercourse_change_6585'</span>] <span class="op">=</span> (grid.watercourse_length_85 <span class="op">-</span> grid.watercourse_length_65) </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'watercourse_change_8505'</span>] <span class="op">=</span> (grid.watercourse_length_05 <span class="op">-</span> grid.watercourse_length_85) </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'watercourse_change_0522'</span>] <span class="op">=</span> (grid.watercourse_length_22 <span class="op">-</span> grid.watercourse_length_05)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Change stats for 1965-1985:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.watercourse_change_6585 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>watercourse_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.watercourse_change_6585 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>watercourse_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>watercourse_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 1473.98 km
Loss: 89.17 km
Change: 1384.81 km</code></pre>
</div>
</div>
<p>Change stats for 1985-2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.watercourse_change_8505 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>watercourse_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.watercourse_change_8505 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>watercourse_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>watercourse_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 689.11 km
Loss: 94.68 km
Change: 594.43 km</code></pre>
</div>
</div>
<p>Change stats for 2005-2022</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.watercourse_change_0522 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>watercourse_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.watercourse_change_0522 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>watercourse_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>watercourse_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 281.52 km
Loss: 107.85 km
Change: 173.67 km</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> colors</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">17</span>,<span class="dv">5</span>), dpi<span class="op">=</span><span class="dv">200</span>, gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.05</span>]})</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'watercourse_change_6585'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>], vmin<span class="op">=-</span><span class="dv">5</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'watercourse_change_8505'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>], vmin<span class="op">=-</span><span class="dv">5</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'watercourse_change_0522'</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>], vmin<span class="op">=-</span><span class="dv">5</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'1965-1985'</span>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'1985-2005'</span>)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>].set_title(<span class="st">'2005-2022'</span>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> colors.Normalize(vmin<span class="op">=-</span><span class="dv">5</span>,vmax<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">'seismic'</span>, norm<span class="op">=</span>norm)</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> [<span class="op">-</span><span class="dv">5</span>,<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(sm, cax<span class="op">=</span>axs[<span class="dv">3</span>], ticks<span class="op">=</span>ticks)</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>cbar.ax.set_yticklabels([<span class="ss">f'</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss"> km'</span> <span class="cf">for</span> t <span class="kw">in</span> ticks])</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Changes in watercourse lengths, aggregated to 500x500m grid'</span>)</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-88-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Visualize the locations where there has been the most decrease in watercourse length between 1965 and 1985.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>watercourseloss_6585_cellid <span class="op">=</span> grid[grid.watercourse_change_6585 <span class="op">==</span> grid.watercourse_change_6585.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercourseloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>watercourses_65.clip(grid[grid.cellid <span class="op">==</span> watercourseloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 1965'</span>)</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercourseloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>watercourses_80s.clip(grid[grid.cellid <span class="op">==</span> watercourseloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 1985'</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> watercourseloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> watercourseloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-89-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Same for 1985 and 2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>watercourseloss_8505_cellid <span class="op">=</span> grid[grid.watercourse_change_8505 <span class="op">==</span> grid.watercourse_change_8505.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercourseloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>watercourses_80s.clip(grid[grid.cellid <span class="op">==</span> watercourseloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 1985'</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercourseloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>watercourses_05.clip(grid[grid.cellid <span class="op">==</span> watercourseloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 2005'</span>)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> watercourseloss_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> watercourseloss_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-90-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>And then same visualizations for watercourse length increase.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>watercoursegain_6585_cellid <span class="op">=</span> grid[grid.watercourse_change_6585 <span class="op">==</span> grid.watercourse_change_6585.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercoursegain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>watercourses_65.clip(grid[grid.cellid <span class="op">==</span> watercoursegain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 1965'</span>)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercoursegain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>watercourses_80s.clip(grid[grid.cellid <span class="op">==</span> watercoursegain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 1985'</span>)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> watercoursegain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> watercoursegain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-91-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>watercoursegain_8505_cellid <span class="op">=</span> grid[grid.watercourse_change_8505 <span class="op">==</span> grid.watercourse_change_8505.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>watercourses_80s.clip(grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 1985'</span>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>watercourses_05.clip(grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 2005'</span>)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-92-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The example above shows the difficulty of distinguishing between water bodies and watercourses, and how converting some watercourses into line geometries may fail. See a better example with the fifth highest.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>watercoursegain_8505_cellid <span class="op">=</span> grid[grid.watercourse_change_8505 <span class="op">==</span> np.partition(grid.watercourse_change_8505.values, <span class="op">-</span><span class="dv">5</span>)[<span class="op">-</span><span class="dv">5</span>]].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>watercourses_80s.clip(grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 1985'</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>watercourses_05.clip(grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:cyan'</span>).set_title(<span class="st">'watercourses in 2005'</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> watercoursegain_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-93-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="field-watercourse--combinations" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="field-watercourse--combinations"><span class="header-section-number">2.4.1</span> Field-watercourse -combinations</h3>
<p>Check how ditching has changed in fields, e.g.&nbsp;does shift to sub-surface drainage systems show in these data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>fields_65[<span class="st">'drainage_len'</span>] <span class="op">=</span> fields_65.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_65, watercourses_65.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>fields_80s[<span class="st">'drainage_len'</span>] <span class="op">=</span> fields_80s.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_80s, watercourses_80s.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>fields_05[<span class="st">'drainage_len'</span>] <span class="op">=</span> fields_05.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_05, watercourses_05.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>fields_22[<span class="st">'drainage_len'</span>] <span class="op">=</span> fields_22.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_22, watercourses_22.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total length of waterways in fields in 1965: </span><span class="sc">{</span>fields_65<span class="sc">.</span>drainage_len<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>) </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total length of waterways in fields in 1985: </span><span class="sc">{</span>fields_80s<span class="sc">.</span>drainage_len<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>) </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total length of waterways in fields in 2005: </span><span class="sc">{</span>fields_05<span class="sc">.</span>drainage_len<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>) </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total length of waterways in fields in 2022: </span><span class="sc">{</span>fields_22<span class="sc">.</span>drainage_len<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total length of waterways in fields in 1965: 266.62 km
Total length of waterways in fields in 1985: 273.78 km
Total length of waterways in fields in 2005: 194.06 km
Total length of waterways in fields in 2022: 166.73 km</code></pre>
</div>
</div>
</section>
<section id="mire-watercourse--combinations" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="mire-watercourse--combinations"><span class="header-section-number">2.4.2</span> Mire-watercourse -combinations</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>mires_65[<span class="st">'drainage_len'</span>] <span class="op">=</span> mires_65.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_65, watercourses_65.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>mires_80s[<span class="st">'drainage_len'</span>] <span class="op">=</span> mires_80s.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_80s, watercourses_80s.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>mires_05[<span class="st">'drainage_len'</span>] <span class="op">=</span> mires_05.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_05, watercourses_05.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>mires_22[<span class="st">'drainage_len'</span>] <span class="op">=</span> mires_22.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_22, watercourses_22.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total length of waterways in mires in 1965: </span><span class="sc">{</span>mires_65<span class="sc">.</span>drainage_len<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>) </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total length of waterways in mires in 1985: </span><span class="sc">{</span>mires_80s<span class="sc">.</span>drainage_len<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>) </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total length of waterways in mires in 2005: </span><span class="sc">{</span>mires_05<span class="sc">.</span>drainage_len<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>) </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total length of waterways in mires in 2022: </span><span class="sc">{</span>mires_22<span class="sc">.</span>drainage_len<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total length of waterways in mires in 1965: 447.12 km
Total length of waterways in mires in 1985: 1604.50 km
Total length of waterways in mires in 2005: 1925.36 km
Total length of waterways in mires in 2022: 2104.92 km</code></pre>
</div>
</div>
<p>Watercourse changes can indicating ditching or restoration can be visualized for mires area. In this example, we use the mire layer from 1965 maps as the aggregation layer.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>mires_65[<span class="st">'drainage_len_65'</span>] <span class="op">=</span> mires_65.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_65, watercourses_65.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>mires_65[<span class="st">'drainage_len_85'</span>] <span class="op">=</span> mires_65.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_80s, watercourses_80s.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>mires_65[<span class="st">'drainage_len_05'</span>] <span class="op">=</span> mires_65.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_05, watercourses_05.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>mires_65[<span class="st">'drainage_len_22'</span>] <span class="op">=</span> mires_65.progress_apply(<span class="kw">lambda</span> row: get_len(row, watercourses_22, watercourses_22.sindex), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>mires_65[<span class="st">'drain_change_6585'</span>] <span class="op">=</span> (mires_65.drainage_len_85 <span class="op">-</span> mires_65.drainage_len_65)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>mires_65[<span class="st">'drain_change_8505'</span>] <span class="op">=</span> (mires_65.drainage_len_05 <span class="op">-</span> mires_65.drainage_len_85)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>mires_65[<span class="st">'drain_change_0522'</span>] <span class="op">=</span> (mires_65.drainage_len_22 <span class="op">-</span> mires_65.drainage_len_05)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Filter out the mire where the ditching has been the most aggressive between 1965 and 1985.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>largest_mire <span class="op">=</span> mires_65[mires_65.drain_change_6585 <span class="op">==</span> mires_65.drain_change_6585.<span class="bu">max</span>()].geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>mires_65.clip(largest_mire, keep_geom_type<span class="op">=</span><span class="va">True</span>).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>mires_80s.clip(largest_mire, keep_geom_type<span class="op">=</span><span class="va">True</span>).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>mires_05.clip(largest_mire, keep_geom_type<span class="op">=</span><span class="va">True</span>).plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>mires_22.clip(largest_mire, keep_geom_type<span class="op">=</span><span class="va">True</span>).plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>watercourses_65.clip(largest_mire, keep_geom_type<span class="op">=</span><span class="va">True</span>).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>watercourses_80s.clip(largest_mire).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>watercourses_05.clip(largest_mire).plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>watercourses_22.clip(largest_mire).plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Watercourses in 1965, </span><span class="sc">{</span>watercourses_65<span class="sc">.</span>clip(largest_mire)<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Watercourses in 1985, </span><span class="sc">{</span>watercourses_80s<span class="sc">.</span>clip(largest_mire)<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Watercourses in 2005, </span><span class="sc">{</span>watercourses_05<span class="sc">.</span>clip(largest_mire)<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Watercourses in 2022, </span><span class="sc">{</span>watercourses_22<span class="sc">.</span>clip(largest_mire)<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.2f}</span><span class="ss"> km'</span>)</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-100-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Same area as map patches and aerial images.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(box(<span class="op">*</span>largest_mire.bounds), <span class="dv">1965</span>, map_path)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs.flatten(): a.axis(<span class="st">'off'</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(box(<span class="op">*</span>largest_mire.bounds), <span class="dv">1985</span>, map_path)</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="co"># WCS only supports 2x2km images so need to get creative</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>midx <span class="op">=</span> (largest_mire.bounds[<span class="dv">2</span>] <span class="op">-</span> largest_mire.bounds[<span class="dv">0</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>midy <span class="op">=</span> (largest_mire.bounds[<span class="dv">3</span>] <span class="op">-</span> largest_mire.bounds[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>botl,_ <span class="op">=</span> get_wcs_img((largest_mire.bounds[<span class="dv">0</span>], </span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">1</span>], </span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">2</span>]<span class="op">-</span>midx, </span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]<span class="op">-</span>midy), <span class="dv">2005</span>)</span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a>botr,_ <span class="op">=</span> get_wcs_img((largest_mire.bounds[<span class="dv">2</span>]<span class="op">-</span>midx, </span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">1</span>], </span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">2</span>], </span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]<span class="op">-</span>midy), <span class="dv">2005</span>)</span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a>topl,_ <span class="op">=</span> get_wcs_img((largest_mire.bounds[<span class="dv">0</span>], </span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]<span class="op">-</span>midy, </span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">2</span>]<span class="op">-</span>midx, </span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]), <span class="dv">2005</span>)</span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a>topr,year <span class="op">=</span> get_wcs_img((largest_mire.bounds[<span class="dv">2</span>]<span class="op">-</span>midx, </span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]<span class="op">-</span>midy, </span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">2</span>],</span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]), <span class="dv">2005</span>)</span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a>toprow <span class="op">=</span> np.hstack((topl, topr))</span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a>botrow <span class="op">=</span> np.hstack((botl, botr))</span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a>full <span class="op">=</span> np.vstack((toprow, botrow))</span>
<span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(full, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb121-35"><a href="#cb121-35" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb121-36"><a href="#cb121-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-37"><a href="#cb121-37" aria-hidden="true" tabindex="-1"></a>botl,_ <span class="op">=</span> get_wcs_img((largest_mire.bounds[<span class="dv">0</span>], </span>
<span id="cb121-38"><a href="#cb121-38" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">1</span>], </span>
<span id="cb121-39"><a href="#cb121-39" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">2</span>]<span class="op">-</span>midx, </span>
<span id="cb121-40"><a href="#cb121-40" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]<span class="op">-</span>midy), <span class="dv">2022</span>)</span>
<span id="cb121-41"><a href="#cb121-41" aria-hidden="true" tabindex="-1"></a>botr,_ <span class="op">=</span> get_wcs_img((largest_mire.bounds[<span class="dv">2</span>]<span class="op">-</span>midx, </span>
<span id="cb121-42"><a href="#cb121-42" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">1</span>], </span>
<span id="cb121-43"><a href="#cb121-43" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">2</span>], </span>
<span id="cb121-44"><a href="#cb121-44" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]<span class="op">-</span>midy), <span class="dv">2022</span>)</span>
<span id="cb121-45"><a href="#cb121-45" aria-hidden="true" tabindex="-1"></a>topl,_ <span class="op">=</span> get_wcs_img((largest_mire.bounds[<span class="dv">0</span>], </span>
<span id="cb121-46"><a href="#cb121-46" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]<span class="op">-</span>midy, </span>
<span id="cb121-47"><a href="#cb121-47" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">2</span>]<span class="op">-</span>midx, </span>
<span id="cb121-48"><a href="#cb121-48" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]), <span class="dv">2022</span>)</span>
<span id="cb121-49"><a href="#cb121-49" aria-hidden="true" tabindex="-1"></a>topr,year <span class="op">=</span> get_wcs_img((largest_mire.bounds[<span class="dv">2</span>]<span class="op">-</span>midx, </span>
<span id="cb121-50"><a href="#cb121-50" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]<span class="op">-</span>midy, </span>
<span id="cb121-51"><a href="#cb121-51" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">2</span>],</span>
<span id="cb121-52"><a href="#cb121-52" aria-hidden="true" tabindex="-1"></a>                      largest_mire.bounds[<span class="dv">3</span>]), <span class="dv">2022</span>)</span>
<span id="cb121-53"><a href="#cb121-53" aria-hidden="true" tabindex="-1"></a>toprow <span class="op">=</span> np.hstack((topl, topr))</span>
<span id="cb121-54"><a href="#cb121-54" aria-hidden="true" tabindex="-1"></a>botrow <span class="op">=</span> np.hstack((botl, botr))</span>
<span id="cb121-55"><a href="#cb121-55" aria-hidden="true" tabindex="-1"></a>full <span class="op">=</span> np.vstack((toprow, botrow))</span>
<span id="cb121-56"><a href="#cb121-56" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(full, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb121-57"><a href="#cb121-57" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb121-58"><a href="#cb121-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-101-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="water-bodies-1" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="water-bodies-1"><span class="header-section-number">2.5</span> Water bodies</h2>
<p>Even though water bodies dont change that much, lets visualize them for completeness.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> results:</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>    polygonize(respath<span class="op">/</span>r, polypath<span class="op">/</span><span class="st">'waterbodies'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">5</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>waterbodies_65 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>waterbodies_80s <span class="op">=</span> <span class="va">None</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> os.listdir(polypath<span class="op">/</span><span class="st">'waterbodies'</span>):</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>    union_gdf <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'waterbodies'</span><span class="op">/</span>p)</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'1965'</span> <span class="kw">in</span> p:</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> waterbodies_65 <span class="kw">is</span> <span class="va">None</span>: waterbodies_65 <span class="op">=</span> union_gdf</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: waterbodies_65 <span class="op">=</span> pd.concat((waterbodies_65, union_gdf))</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> waterbodies_80s <span class="kw">is</span> <span class="va">None</span>: waterbodies_80s <span class="op">=</span> union_gdf</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: waterbodies_80s <span class="op">=</span> pd.concat((waterbodies_80s, union_gdf))</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>waterbodies_65 <span class="op">=</span> waterbodies_65.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>waterbodies_80s <span class="op">=</span> waterbodies_80s.clip(study_area.geometry.iloc[<span class="dv">0</span>])</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>waterbodies_65.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>waterbodies_80s.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>waterbodies_05 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2005/waterbodies.geojson'</span>)</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>waterbodies_22 <span class="op">=</span> gpd.read_file(mtk_path<span class="op">/</span><span class="st">'2022/jarvet_2022.geojson'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>waterbodies_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Water bodies 1965, total area </span><span class="sc">{</span>waterbodies_65<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>waterbodies_80s.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Water bodies 1984-1985 </span><span class="sc">{</span>waterbodies_80s<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>waterbodies_05.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Water bodies 2005 </span><span class="sc">{</span>waterbodies_05<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>waterbodies_22.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>)</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Water bodies 2022 </span><span class="sc">{</span>waterbodies_22<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>() <span class="op">*</span> <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-104-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Some changes are due to model classifying wide rivers etc. as water bodies instead of watercourses.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, waterbodies_65, <span class="st">'waterbody_area_65'</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, waterbodies_80s, <span class="st">'waterbody_area_85'</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, waterbodies_05, <span class="st">'waterbody_area_05'</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> aggregate_area_to_grid(grid, waterbodies_22, <span class="st">'waterbody_area_22'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">10</span>))</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>grid.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'waterbody_area_65'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'1965'</span>)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'waterbody_area_85'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'1984-1985'</span>)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'waterbody_area_05'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'2005'</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'waterbody_area_22'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>], vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">.500</span><span class="op">**</span><span class="dv">2</span>, legend<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">'2022'</span>)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-106-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Quantify the change. Negative change means decreased waterbody area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'waterbody_change_6585'</span>] <span class="op">=</span> (grid.waterbody_area_85 <span class="op">-</span> grid.waterbody_area_65)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'waterbody_change_8505'</span>] <span class="op">=</span> (grid.waterbody_area_05 <span class="op">-</span> grid.waterbody_area_85)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'waterbody_change_0522'</span>] <span class="op">=</span> (grid.waterbody_area_22 <span class="op">-</span> grid.waterbody_area_05)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Change stats for 1965-1985:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.waterbody_change_6585 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>waterbody_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.waterbody_change_6585 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>waterbody_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>waterbody_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 0.97 km짼
Loss: 1.93 km짼
Change: -0.97 km짼</code></pre>
</div>
</div>
<p>Change stats for 1985-2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.waterbody_change_8505 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>waterbody_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.waterbody_change_8505 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>waterbody_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>waterbody_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 2.01 km짼
Loss: 0.77 km짼
Change: 1.24 km짼</code></pre>
</div>
</div>
<p>Change stats for 2005-2022</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Gain: </span><span class="sc">{</span>grid[grid.waterbody_change_0522 <span class="op">&gt;</span> <span class="dv">0</span>]<span class="sc">.</span>waterbody_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Loss: </span><span class="sc">{</span><span class="op">-</span>grid[grid.waterbody_change_0522 <span class="op">&lt;</span> <span class="dv">0</span>]<span class="sc">.</span>waterbody_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Change: </span><span class="sc">{</span>grid<span class="sc">.</span>waterbody_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gain: 0.38 km짼
Loss: 0.18 km짼
Change: 0.20 km짼</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>), dpi<span class="op">=</span><span class="dv">200</span>, gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">0.05</span>]})</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'waterbody_change_6585'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'waterbody_change_8505'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>])</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>grid.plot(column<span class="op">=</span><span class="st">'waterbody_change_0522'</span>, cmap<span class="op">=</span><span class="st">'seismic'</span>, vmin<span class="op">=-</span><span class="fl">.20</span>, vmax<span class="op">=</span><span class="fl">.20</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>])</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="ss">f'1965-1985, total change </span><span class="sc">{</span>grid<span class="sc">.</span>waterbody_change_6585<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="ss">f'1985-2005, total change </span><span class="sc">{</span>grid<span class="sc">.</span>waterbody_change_8505<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>].set_title(<span class="ss">f'2005-2022, total change </span><span class="sc">{</span>grid<span class="sc">.</span>waterbody_change_0522<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.2f}</span><span class="ss"> km짼'</span>)</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> colors.Normalize(vmin<span class="op">=-</span><span class="fl">.2</span>,vmax<span class="op">=</span><span class="fl">.2</span>)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">'seismic'</span>, norm<span class="op">=</span>norm)</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>ticks <span class="op">=</span> [<span class="op">-</span><span class="fl">.2</span>,<span class="op">-</span><span class="fl">.1</span>,<span class="dv">0</span>,<span class="fl">.1</span>,<span class="fl">.2</span>]</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(sm, cax<span class="op">=</span>axs[<span class="dv">3</span>], ticks<span class="op">=</span>ticks)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>cbar.ax.set_yticklabels([<span class="ss">f'</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss"> km짼'</span> <span class="cf">for</span> t <span class="kw">in</span> ticks])</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Changes in waterbody area, aggregated to 500x500m grid'</span>)</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-111-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Visualize the location where the waterbody area has decreased the most between 1965 and 1985. For 1965 and 1980s show the corresponding map patch along with the data.</p>
<p>For 2005 and 2022, show the closest aerial image to that year. Unfortunately the closest historical images available are from 1949 and 1979, so we cant really use them for visualizations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>waterbodyloss_6585_cellid <span class="op">=</span> grid[grid.waterbody_change_6585 <span class="op">==</span> grid.waterbody_change_6585.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> waterbodyloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>waterbodies_65.clip(grid[grid.cellid <span class="op">==</span> waterbodyloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>).set_title(<span class="st">'waterbodies in 1965'</span>)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> waterbodyloss_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>waterbodies_80s.clip(grid[grid.cellid <span class="op">==</span> waterbodyloss_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>).set_title(<span class="st">'waterbodies in 1985'</span>)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> waterbodyloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> waterbodyloss_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-112-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Same for 1985 and 2005</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>waterbodyloss_8505_cellid <span class="op">=</span> grid[grid.waterbody_change_8505 <span class="op">==</span> grid.waterbody_change_8505.<span class="bu">min</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> waterbodyloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>waterbodies_80s.clip(grid[grid.cellid <span class="op">==</span> waterbodyloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>).set_title(<span class="st">'waterbodies in 1985'</span>)</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> waterbodyloss_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>waterbodies_05.clip(grid[grid.cellid <span class="op">==</span> waterbodyloss_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>).set_title(<span class="st">'waterbodies in 2005'</span>)</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> waterbodyloss_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> waterbodyloss_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-113-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>And then same visualizations for waterbody area increase.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>waterbodygain_6585_cellid <span class="op">=</span> grid[grid.waterbody_change_6585 <span class="op">==</span> grid.waterbody_change_6585.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> waterbodygain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>waterbodies_65.clip(grid[grid.cellid <span class="op">==</span> waterbodygain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>).set_title(<span class="st">'waterbodies in 1965'</span>)</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> waterbodygain_6585_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>waterbodies_80s.clip(grid[grid.cellid <span class="op">==</span> waterbodygain_6585_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>).set_title(<span class="st">'waterbodies in 1985'</span>)</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> waterbodygain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1965</span>, map_path)</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1965'</span>)</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> waterbodygain_6585_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-114-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>waterbodygain_8505_cellid <span class="op">=</span> grid[grid.waterbody_change_8505 <span class="op">==</span> grid.waterbody_change_8505.<span class="bu">max</span>()].cellid.iloc[<span class="dv">0</span>]</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> waterbodygain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>waterbodies_80s.clip(grid[grid.cellid <span class="op">==</span> waterbodygain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>).set_title(<span class="st">'waterbodies in 1985'</span>)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>grid[grid.cellid <span class="op">==</span> waterbodygain_8505_cellid].plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>waterbodies_05.clip(grid[grid.cellid <span class="op">==</span> waterbodygain_8505_cellid].geometry).plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'tab:blue'</span>).set_title(<span class="st">'waterbodies in 2005'</span>)</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> get_map_patch(grid[grid.cellid <span class="op">==</span> waterbodygain_8505_cellid].geometry.iloc[<span class="dv">0</span>], <span class="dv">1985</span>, map_path)</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'Map patch from 1980s'</span>)</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>img, year <span class="op">=</span> get_wcs_img(grid[grid.cellid <span class="op">==</span> waterbodygain_8505_cellid].total_bounds, <span class="dv">2005</span>)</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'Aerial image from </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="change_analysis_files/figure-html/cell-115-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "材";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./postprocessings.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Predictions and postprocessings</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>