<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Janne Mäyrä">
<meta name="dcterms.date" content="2023-02-27">

<title>Monitoring land cover changes using historical maps - Predictions and postprocessings</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./change_analysis.html" rel="next">
<link href="./train_model.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<meta property="og:title" content="Monitoring land cover changes using historical maps - Predictions and postprocessings">
<meta property="og:description" content="We then used the model trained previously to classify all historical maps from our study area. In order to reduce noise and make predictions smoother, some post-processing steps are required.">
<meta property="og:site-name" content="Monitoring land cover changes using historical maps">
<meta name="twitter:title" content="Monitoring land cover changes using historical maps - Predictions and postprocessings">
<meta name="twitter:description" content="We then used the model trained previously to classify all historical maps from our study area. In order to reduce noise and make predictions smoother, some post-processing steps are required.">
<meta name="twitter:creator" content="@mayrajeo">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Monitoring land cover changes using historical maps</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mayrajeo/historical-maps/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Predictions and postprocessings</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Workflow</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./crop_and_georeference.html" class="sidebar-item-text sidebar-link">Crop and georeference old maps</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./color_extraction.html" class="sidebar-item-text sidebar-link">Extracting colors with simple thresholding</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./make_masks.html" class="sidebar-item-text sidebar-link">Create reference masks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./train_model.html" class="sidebar-item-text sidebar-link">Train model</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./postprocessings.html" class="sidebar-item-text sidebar-link active">Predictions and postprocessings</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./change_analysis.html" class="sidebar-item-text sidebar-link">Change analysis</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#evaluate-results-before-post-processing" id="toc-evaluate-results-before-post-processing" class="nav-link active" data-scroll-target="#evaluate-results-before-post-processing"><span class="toc-section-number">1</span>  Evaluate results before post-processing</a></li>
  <li><a href="#postprocessing" id="toc-postprocessing" class="nav-link" data-scroll-target="#postprocessing"><span class="toc-section-number">2</span>  Postprocessing</a>
  <ul class="collapse">
  <li><a href="#fields" id="toc-fields" class="nav-link" data-scroll-target="#fields"><span class="toc-section-number">2.1</span>  Fields</a></li>
  <li><a href="#mires" id="toc-mires" class="nav-link" data-scroll-target="#mires"><span class="toc-section-number">2.2</span>  Mires</a></li>
  <li><a href="#roads" id="toc-roads" class="nav-link" data-scroll-target="#roads"><span class="toc-section-number">2.3</span>  Roads</a></li>
  <li><a href="#watercourses" id="toc-watercourses" class="nav-link" data-scroll-target="#watercourses"><span class="toc-section-number">2.4</span>  Watercourses</a></li>
  <li><a href="#water-bodies" id="toc-water-bodies" class="nav-link" data-scroll-target="#water-bodies"><span class="toc-section-number">2.5</span>  Water bodies</a></li>
  <li><a href="#all-together" id="toc-all-together" class="nav-link" data-scroll-target="#all-together"><span class="toc-section-number">2.6</span>  All together:</a></li>
  </ul></li>
  <li><a href="#evaluating-post-processed-test-set" id="toc-evaluating-post-processed-test-set" class="nav-link" data-scroll-target="#evaluating-post-processed-test-set"><span class="toc-section-number">3</span>  Evaluating post-processed test set</a></li>
  <li><a href="#generate-polygon-and-line-data" id="toc-generate-polygon-and-line-data" class="nav-link" data-scroll-target="#generate-polygon-and-line-data"><span class="toc-section-number">4</span>  Generate polygon and line data</a>
  <ul class="collapse">
  <li><a href="#roads-1" id="toc-roads-1" class="nav-link" data-scroll-target="#roads-1"><span class="toc-section-number">4.1</span>  Roads</a></li>
  <li><a href="#watercourses-1" id="toc-watercourses-1" class="nav-link" data-scroll-target="#watercourses-1"><span class="toc-section-number">4.2</span>  Watercourses</a></li>
  </ul></li>
  <li><a href="#compare-predicted-and-annotated-total-area-and-length" id="toc-compare-predicted-and-annotated-total-area-and-length" class="nav-link" data-scroll-target="#compare-predicted-and-annotated-total-area-and-length"><span class="toc-section-number">5</span>  Compare predicted and annotated total area and length</a>
  <ul class="collapse">
  <li><a href="#fields-1" id="toc-fields-1" class="nav-link" data-scroll-target="#fields-1"><span class="toc-section-number">5.1</span>  Fields</a></li>
  <li><a href="#mires-1" id="toc-mires-1" class="nav-link" data-scroll-target="#mires-1"><span class="toc-section-number">5.2</span>  Mires</a></li>
  <li><a href="#roads-2" id="toc-roads-2" class="nav-link" data-scroll-target="#roads-2"><span class="toc-section-number">5.3</span>  Roads</a></li>
  <li><a href="#watercourses-2" id="toc-watercourses-2" class="nav-link" data-scroll-target="#watercourses-2"><span class="toc-section-number">5.4</span>  Watercourses</a></li>
  <li><a href="#water-bodies-1" id="toc-water-bodies-1" class="nav-link" data-scroll-target="#water-bodies-1"><span class="toc-section-number">5.5</span>  Water bodies</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mayrajeo/historical-maps/blob/main/nbs/postprocessings.ipynb" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Predictions and postprocessings</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Janne Mäyrä </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 27, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>We then used the model trained previously to classify all historical maps from our study area. In order to reduce noise and make predictions smoother, some post-processing steps are required. For this, we used morphological operations such as <strong>closing</strong>, and <strong>erosion</strong>, as well as <strong>low-pass filtering</strong> with suitable kernel sizes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio.mask <span class="im">as</span> rio_mask</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> fiona</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio <span class="im">import</span> features</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.enums <span class="im">import</span> Resampling</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> skeletonize, medial_axis, thin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> polygonize(fn, outpath, target_class, scale_factor<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(fn) <span class="im">as</span> src:</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> src.read(out_shape<span class="op">=</span>(src.count, <span class="bu">int</span>(src.height<span class="op">*</span>scale_factor),<span class="bu">int</span>(src.width<span class="op">*</span>scale_factor)),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                      resampling<span class="op">=</span>Resampling.mode)[target_class <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        im[im <span class="op">!=</span>  <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> im <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        tfm <span class="op">=</span> src.transform <span class="op">*</span> src.transform.scale((src.width<span class="op">/</span>im.shape[<span class="op">-</span><span class="dv">1</span>]), (src.height<span class="op">/</span>im.shape[<span class="op">-</span><span class="dv">2</span>]))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> ({<span class="st">'properties'</span>: {<span class="st">'raster_val'</span>: v}, <span class="st">'geometry'</span>: s}</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">for</span> i, (s, v) <span class="kw">in</span> <span class="bu">enumerate</span>(features.shapes(im, mask<span class="op">==</span>mask, transform<span class="op">=</span>tfm))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span> v <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> fiona.<span class="bu">open</span>(outpath, <span class="st">'w'</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                        crs<span class="op">=</span><span class="st">'EPSG:3067'</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                        schema<span class="op">=</span>{<span class="st">'properties'</span>: [(<span class="st">'raster_val'</span>, <span class="st">'int'</span>)],</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'geometry'</span>: <span class="st">'Polygon'</span>}) <span class="im">as</span> dst:</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            dst.writerecords(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_grid(area, cell):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    xmin, ymin, xmax, ymax <span class="op">=</span> area.total_bounds</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> <span class="bu">list</span>(np.arange(xmin, xmax<span class="op">+</span>cell, cell))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> <span class="bu">list</span>(np.arange(ymin, ymax<span class="op">+</span>cell, cell))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    polys <span class="op">=</span> []</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    names <span class="op">=</span> []</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (C,x), (R,y) <span class="kw">in</span> product(<span class="bu">enumerate</span>(cols[:<span class="op">-</span><span class="dv">1</span>]), <span class="bu">enumerate</span>(rows[:<span class="op">-</span><span class="dv">1</span>])):</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        polys.append(Polygon([(x,y), (x<span class="op">+</span>cell, y), (x<span class="op">+</span>cell,y<span class="op">+</span>cell),(x, y<span class="op">+</span>cell)]))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        names.append(<span class="ss">f'R</span><span class="sc">{</span>R<span class="sc">}</span><span class="ss">C</span><span class="sc">{</span>C<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gpd.GeoDataFrame({<span class="st">'geometry'</span>:polys, <span class="st">'cellid'</span>:names}, crs<span class="op">=</span>area.crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="evaluate-results-before-post-processing" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Evaluate results before post-processing</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_score, recall_score</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dice(targs, preds, cls_id):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    inter <span class="op">=</span> (np.where(targs<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>)<span class="op">*</span>np.where(preds<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    union <span class="op">=</span> (np.where(targs<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>)<span class="op">+</span>np.where(preds<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> inter<span class="op">/</span>union <span class="cf">if</span> union <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jaccard(targs, preds, cls_id):</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    inter <span class="op">=</span> (np.where(targs<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>)<span class="op">*</span>np.where(preds<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    union <span class="op">=</span> (np.where(targs<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>)<span class="op">+</span>np.where(preds<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inter<span class="op">/</span>(union<span class="op">-</span>inter) <span class="cf">if</span> union <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pre(targs, preds, cls_id):</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> precision_score(np.where(targs<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>).flatten(), np.where(preds<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>).flatten())</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rec(targs, preds, cls_id):</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> recall_score(np.where(targs<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>).flatten(), np.where(preds<span class="op">==</span>cls_id, <span class="dv">1</span>, <span class="dv">0</span>).flatten())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'../data/reference_masks/val_mask_1965.tif'</span>) <span class="im">as</span> test_src:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    bounds_65 <span class="op">=</span> test_src.bounds</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'../results/raw/213405_1965.tif'</span>) <span class="im">as</span> pred_src:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        bounds_test <span class="op">=</span> pred_src.bounds</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        preds_65, _ <span class="op">=</span> rio_mask.mask(pred_src, [box(<span class="op">*</span>bounds_test).intersection(box(<span class="op">*</span>bounds_65))], crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        preds_65 <span class="op">=</span> preds_65[<span class="dv">0</span>]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    test_mask_65, _ <span class="op">=</span> rio_mask.mask(test_src, [box(<span class="op">*</span>bounds_test).intersection(box(<span class="op">*</span>bounds_65))], crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    test_mask_65 <span class="op">=</span> test_mask_65[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> colors</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> colors.ListedColormap([<span class="st">'white'</span>, <span class="st">'tab:orange'</span>, <span class="st">'tab:grey'</span>, <span class="st">'tab:red'</span>, <span class="st">'tab:cyan'</span>, <span class="st">'tab:blue'</span>])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>bounds<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> colors.BoundaryNorm(bounds, cmap.N)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(test_mask_65, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span>cmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Targets 65'</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(preds_65, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span>cmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Predictions 65'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'../data/reference_masks/val_mask_1984.tif'</span>) <span class="im">as</span> test_src:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    bounds_84 <span class="op">=</span> test_src.bounds</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'../results/raw/213405_1984.tif'</span>) <span class="im">as</span> pred_src:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        bounds_test <span class="op">=</span> pred_src.bounds</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        preds_84, _ <span class="op">=</span> rio_mask.mask(pred_src, [box(<span class="op">*</span>bounds_test).intersection(box(<span class="op">*</span>bounds_84))], crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        preds_84 <span class="op">=</span> preds_84[<span class="dv">0</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    test_mask_84, _ <span class="op">=</span> rio_mask.mask(test_src, [box(<span class="op">*</span>bounds_test).intersection(box(<span class="op">*</span>bounds_84))], crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    test_mask_84 <span class="op">=</span> test_mask_84[<span class="dv">0</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(test_mask_84, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span>cmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Targets 84'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(preds_84, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span>cmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Predictions 84'</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Evaluate predictions before post-processing.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> [<span class="st">'Fields'</span>, <span class="st">'Mires'</span>, <span class="st">'Roads'</span>, <span class="st">'Watercourses'</span>, <span class="st">'Water bodies'</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>dices_65 <span class="op">=</span> []</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>dices_84 <span class="op">=</span> []</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>ious_65 <span class="op">=</span> []</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ious_84 <span class="op">=</span> []</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>pres_65 <span class="op">=</span> []</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>pres_84 <span class="op">=</span> []</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>recs_65 <span class="op">=</span> []</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>recs_84 <span class="op">=</span> []</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">5</span>):</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    dice_65 <span class="op">=</span> dice(test_mask_65, preds_65, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    dice_84 <span class="op">=</span> dice(test_mask_84, preds_84, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    dices_65.append(dice_65)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    dices_84.append(dice_84)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    iou_65 <span class="op">=</span> jaccard(test_mask_65, preds_65, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    iou_84 <span class="op">=</span> jaccard(test_mask_84, preds_84, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    ious_65.append(iou_65)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    ious_84.append(iou_84)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    pre_65 <span class="op">=</span> pre(test_mask_65, preds_65, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    pre_84 <span class="op">=</span> pre(test_mask_84, preds_84, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    pres_65.append(pre_65)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    pres_84.append(pre_84)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    rec_65 <span class="op">=</span> rec(test_mask_65, preds_65, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    rec_84 <span class="op">=</span> rec(test_mask_84, preds_84, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    recs_65.append(rec_65)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    recs_84.append(rec_84)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Results for class </span><span class="sc">{</span>classes[c]<span class="sc">}</span><span class="ss">:'</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Dice: 65 map: </span><span class="sc">{</span>dice_65<span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span>dice_84<span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(dice_65<span class="op">+</span>dice_84)<span class="op">/</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Jaccard: 65 map: </span><span class="sc">{</span>iou_65<span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span>iou_84<span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(iou_65<span class="op">+</span>iou_84)<span class="op">/</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Precision: 65 map: </span><span class="sc">{</span>pre_65<span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span>pre_84<span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(pre_65<span class="op">+</span>pre_84)<span class="op">/</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Recall: 65 map: </span><span class="sc">{</span>rec_65<span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span>rec_84<span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(rec_65<span class="op">+</span>rec_84)<span class="op">/</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ch">\n</span><span class="ss">'</span>)    </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Overall results:'</span>)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Dice: 65 map: </span><span class="sc">{</span><span class="bu">sum</span>(dices_65)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span><span class="bu">sum</span>(dices_84)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(<span class="bu">sum</span>(dices_65)<span class="op">+</span><span class="bu">sum</span>(dices_84))<span class="op">/</span><span class="dv">10</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Jaccard: 65 map: </span><span class="sc">{</span><span class="bu">sum</span>(ious_65)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span><span class="bu">sum</span>(ious_84)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(<span class="bu">sum</span>(ious_65)<span class="op">+</span><span class="bu">sum</span>(ious_84))<span class="op">/</span><span class="dv">10</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Precision: 65 map: </span><span class="sc">{</span><span class="bu">sum</span>(pres_65)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span><span class="bu">sum</span>(pres_84)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(<span class="bu">sum</span>(pres_65)<span class="op">+</span><span class="bu">sum</span>(pres_84))<span class="op">/</span><span class="dv">10</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Recall: 65 map: </span><span class="sc">{</span><span class="bu">sum</span>(recs_65)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span><span class="bu">sum</span>(recs_84)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(<span class="bu">sum</span>(recs_65)<span class="op">+</span><span class="bu">sum</span>(recs_84))<span class="op">/</span><span class="dv">10</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Results for class Fields:
Dice: 65 map: 0.941, 84 map: 0.941, overall 0.941
Jaccard: 65 map: 0.888, 84 map: 0.889, overall 0.889
Precision: 65 map: 0.928, 84 map: 0.931, overall 0.929
Recall: 65 map: 0.954, 84 map: 0.952, overall 0.953

Results for class Mires:
Dice: 65 map: 0.863, 84 map: 0.803, overall 0.833
Jaccard: 65 map: 0.759, 84 map: 0.671, overall 0.715
Precision: 65 map: 0.827, 84 map: 0.767, overall 0.797
Recall: 65 map: 0.902, 84 map: 0.843, overall 0.873

Results for class Roads:
Dice: 65 map: 0.831, 84 map: 0.779, overall 0.805
Jaccard: 65 map: 0.711, 84 map: 0.638, overall 0.674
Precision: 65 map: 0.832, 84 map: 0.734, overall 0.783
Recall: 65 map: 0.830, 84 map: 0.830, overall 0.830

Results for class Watercourses:
Dice: 65 map: 0.709, 84 map: 0.688, overall 0.699
Jaccard: 65 map: 0.550, 84 map: 0.524, overall 0.537
Precision: 65 map: 0.713, 84 map: 0.673, overall 0.693
Recall: 65 map: 0.706, 84 map: 0.703, overall 0.704

Results for class Water bodies:
Dice: 65 map: 0.987, 84 map: 0.984, overall 0.986
Jaccard: 65 map: 0.975, 84 map: 0.969, overall 0.972
Precision: 65 map: 0.987, 84 map: 0.980, overall 0.984
Recall: 65 map: 0.988, 84 map: 0.988, overall 0.988

Overall results:
Dice: 65 map: 0.866, 84 map: 0.839, overall 0.853
Jaccard: 65 map: 0.777, 84 map: 0.738, overall 0.757
Precision: 65 map: 0.857, 84 map: 0.817, overall 0.837
Recall: 65 map: 0.876, 84 map: 0.863, overall 0.870</code></pre>
</div>
</div>
</section>
<section id="postprocessing" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Postprocessing</h1>
<p>The postprocessing steps depend on the land cover class and how they are layered in the final products. Roads and watercourses are such classes that the final products for these are line geometries, whereas the other classes can be either raster data or polygon data. Most watercourses (e.g.&nbsp;ditches) do not split mires and fields into multiple sections, whereas roads split these classes into multiple different segments.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ex_data <span class="op">=</span> <span class="st">'../results/raw/213406_1965_ei_rajoja.tif'</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(ex_data) <span class="im">as</span> src:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>ex_map <span class="op">=</span> <span class="st">'../data/maps/aligned_maps/213406_1965_ei_rajoja.tif'</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(ex_map) <span class="im">as</span> src:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    mapdata <span class="op">=</span> np.moveaxis(src.read(), <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>mapdata <span class="op">=</span> mapdata[<span class="dv">32</span>:, <span class="dv">32</span>:]    </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[:mapdata.shape[<span class="dv">0</span>], :mapdata.shape[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fields" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="fields"><span class="header-section-number">2.1</span> Fields</h2>
<p>Comparison with automatically extracted orange color.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>hsv_field_bot <span class="op">=</span> np.array([<span class="dv">15</span>,<span class="dv">100</span>,<span class="dv">100</span>])</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>hsv_field_top <span class="op">=</span> np.array([<span class="dv">25</span>,<span class="dv">255</span>,<span class="dv">255</span>])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>tempmap <span class="op">=</span> mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>hsv_ex <span class="op">=</span> cv2.cvtColor(tempmap, cv2.COLOR_RGB2HSV)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>field_mask <span class="op">=</span> cv2.inRange(hsv_ex, hsv_field_bot, hsv_field_top)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>field_mask <span class="op">=</span> field_mask.astype(np.int16)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs.flatten(): </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    a.set_xticks([])</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    a.set_yticks([])</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>field_mask[field_mask<span class="op">&lt;</span><span class="dv">128</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>field_mask[field_mask<span class="op">&gt;</span><span class="dv">128</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].imshow(field_mask, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>tempmap <span class="op">=</span> mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> tempmap.copy()</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>temp[field_mask <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].imshow(temp, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Automatical color extraxtion'</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Unprocessed U-net results'</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> np.empty(data.shape)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> fields.astype(np.uint8)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>fields[data<span class="op">==</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> fields[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>]</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(fields, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> tempmap.copy()</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>temp[fields <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(temp, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>During postprocessing, include watercourses for these layers. <code>MORPH.OPEN</code> (erosion followed by dilation) with 11x11 kernel is sufficient to remove watercourses from non-field areas.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> np.empty(data.shape)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fields[data<span class="op">==</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>fields[data<span class="op">==</span><span class="dv">4</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> fields[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> fields.astype(np.uint8)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>tempmap <span class="op">=</span> mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>tempmap[fields <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(fields)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(tempmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.image.AxesImage&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Example postprocessing chain looks like this.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">5</span>,<span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">12</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs.flatten(): </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    a.set_xticks([])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    a.set_yticks([])</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].imshow(fields, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Raw image'</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Raw map'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].imshow(tempmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>er_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_CROSS, (<span class="dv">11</span>,<span class="dv">11</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>dil_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_RECT, (<span class="dv">11</span>,<span class="dv">11</span>))</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.erode(fields, er_kernel)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(open_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Erosion with 11x11 kernel'</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>temp_open <span class="op">=</span> mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>temp_open[open_ex <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(temp_open, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.morphologyEx(open_ex, cv2.MORPH_OPEN, np.ones((<span class="dv">3</span>,<span class="dv">3</span>)))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.dilate(open_ex, dil_kernel)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].imshow(open_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">'Dilation with 11x11 kernel'</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>temp_open <span class="op">=</span> mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>temp_open[open_ex <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">1</span>].imshow(temp_open, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>lpf_kernel <span class="op">=</span> np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.float32)<span class="op">/</span><span class="dv">49</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>lpf_ex <span class="op">=</span> cv2.filter2D(open_ex, <span class="op">-</span><span class="dv">1</span>, lpf_kernel)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">0</span>].imshow(lpf_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">0</span>].set_title(<span class="st">'Low-pass filter with 7x7 kernel'</span>)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>temp_lpf <span class="op">=</span> mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>temp_lpf[lpf_ex <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].imshow(temp_lpf, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>roadclip <span class="op">=</span> lpf_ex.copy()</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>roadclip[data[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>] <span class="op">==</span> <span class="dv">3</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">0</span>].imshow(roadclip, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">0</span>].set_title(<span class="st">'Clipping with roads'</span>)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>temp_lpf[data[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>] <span class="op">==</span> <span class="dv">3</span>] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">1</span>].imshow(temp_lpf, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'../data/figures/field_postproc.jpg'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="mires" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="mires"><span class="header-section-number">2.2</span> Mires</h2>
<p>Similar to fields, watercourses running through mires do not split mires into multiple sections.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mires <span class="op">=</span> np.empty(data.shape)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>mires[data<span class="op">==</span><span class="dv">2</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>mires[data<span class="op">==</span><span class="dv">4</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>mires <span class="op">=</span> mires[<span class="dv">4000</span>:<span class="dv">6000</span>, <span class="dv">2000</span>:<span class="dv">4000</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>mires <span class="op">=</span> mires.astype(np.uint8)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>tempmap <span class="op">=</span> mapdata[<span class="dv">4000</span>:<span class="dv">6000</span>, <span class="dv">2000</span>:<span class="dv">4000</span>,:].copy()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>tempmap[mires <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(mires)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(tempmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.image.AxesImage&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">4</span>,<span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">12</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs.flatten(): a.axis(<span class="st">'off'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].imshow(mires, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Raw image'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Raw map'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].imshow(tempmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>er_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_CROSS, (<span class="dv">13</span>,<span class="dv">13</span>))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>dil_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_RECT, (<span class="dv">13</span>,<span class="dv">13</span>))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.erode(mires, er_kernel)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.morphologyEx(open_ex, cv2.MORPH_OPEN, np.ones((<span class="dv">3</span>,<span class="dv">3</span>)))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.dilate(open_ex, dil_kernel)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(open_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Opening with 11x11 kernel'</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>temp_open <span class="op">=</span>  mapdata[<span class="dv">4000</span>:<span class="dv">6000</span>, <span class="dv">2000</span>:<span class="dv">4000</span>,:].copy()</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>temp_open[open_ex <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(temp_open, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>lpf_kernel <span class="op">=</span> np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.float32)<span class="op">/</span><span class="dv">49</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>lpf_ex <span class="op">=</span> cv2.filter2D(open_ex, <span class="op">-</span><span class="dv">1</span>, lpf_kernel)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].imshow(lpf_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">'Low-pass filter with 7x7 kernel'</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>temp_lpf <span class="op">=</span>  mapdata[<span class="dv">4000</span>:<span class="dv">6000</span>, <span class="dv">2000</span>:<span class="dv">4000</span>,:].copy()</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>temp_lpf[lpf_ex <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">1</span>].imshow(temp_lpf, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>roadclip <span class="op">=</span> lpf_ex.copy()</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>roadclip[data[<span class="dv">4000</span>:<span class="dv">6000</span>, <span class="dv">2000</span>:<span class="dv">4000</span>] <span class="op">==</span> <span class="dv">3</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">0</span>].imshow(roadclip, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">0</span>].set_title(<span class="st">'Clipping with roads'</span>)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>temp_lpf[data[<span class="dv">4000</span>:<span class="dv">6000</span>, <span class="dv">2000</span>:<span class="dv">4000</span>] <span class="op">==</span> <span class="dv">3</span>] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].imshow(temp_lpf, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="roads" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="roads"><span class="header-section-number">2.3</span> Roads</h2>
<p>Roads are postprocessed with <code>MORPH.CLOSE</code> (dilation followed by erosion), LPF and erosion.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> np.empty(data.shape)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>roads[data<span class="op">==</span><span class="dv">3</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> roads[<span class="dv">300</span>:<span class="dv">1300</span>, <span class="dv">4500</span>:<span class="dv">5500</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> roads.astype(np.uint8)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>tempmap <span class="op">=</span> mapdata[<span class="dv">300</span>:<span class="dv">1300</span>, <span class="dv">4500</span>:<span class="dv">5500</span>,:].copy()</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>tempmap[roads <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(roads)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(tempmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.image.AxesImage&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">4</span>,<span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">150</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">16</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs.flatten(): a.axis(<span class="st">'off'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].imshow(roads, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Raw image'</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Raw map'</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].imshow(tempmap)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.uint8)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.morphologyEx(roads, cv2.MORPH_CLOSE, kernel)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>temp_open <span class="op">=</span> mapdata[<span class="dv">300</span>:<span class="dv">1300</span>, <span class="dv">4500</span>:<span class="dv">5500</span>,:].copy()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>temp_open[open_ex <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(open_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Closing with 7x7 kernel'</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(temp_open, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>lpf_kernel <span class="op">=</span> np.ones((<span class="dv">5</span>,<span class="dv">5</span>), np.float32)<span class="op">/</span><span class="dv">25</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>lpf_ex <span class="op">=</span> cv2.filter2D(open_ex, <span class="op">-</span><span class="dv">1</span>, lpf_kernel)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>temp_lpf <span class="op">=</span> temp_open.copy()</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>temp_lpf[lpf_ex <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].imshow(lpf_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">'Low-pass filter with 5x5 kernel'</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">1</span>].imshow(temp_lpf, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>eroded <span class="op">=</span> cv2.erode(lpf_ex, np.ones((<span class="dv">3</span>,<span class="dv">3</span>), np.uint8), iterations<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>temp_er <span class="op">=</span> mapdata[<span class="dv">300</span>:<span class="dv">1300</span>, <span class="dv">4500</span>:<span class="dv">5500</span>,:].copy()</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>temp_er[eroded <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">0</span>].imshow(eroded, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">0</span>].set_title(<span class="st">'Erosion with 3x3 kernel'</span>)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].imshow(temp_er, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Next step is to skeletonize roads in order to generate line geometries from them.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>skeletonized <span class="op">=</span> skeletonize(eroded)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>), dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs: a.axis(<span class="st">'off'</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(eroded, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(skeletonized, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>These are then polygonized and merged into polygon data, that can then be used to get line geometries.</p>
</section>
<section id="watercourses" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="watercourses"><span class="header-section-number">2.4</span> Watercourses</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>watercourses <span class="op">=</span> np.empty(data.shape)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>watercourses[data<span class="op">==</span><span class="dv">4</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>watercourses <span class="op">=</span> watercourses[<span class="dv">2500</span>:<span class="dv">3500</span>,<span class="dv">2000</span>:<span class="dv">3000</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>watercourses <span class="op">=</span> watercourses.astype(np.uint8)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>tempmap <span class="op">=</span> mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>tempmap[watercourses <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(watercourses)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(tempmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.image.AxesImage&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-19-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">4</span>,<span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">150</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">16</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs.flatten(): a.axis(<span class="st">'off'</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].imshow(watercourses, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Raw image'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Raw map'</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].imshow(tempmap)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.uint8)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.morphologyEx(watercourses, cv2.MORPH_CLOSE, kernel)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>temp_open <span class="op">=</span> tempmap.copy()</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>temp_open[open_ex <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(open_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Closing with 7x7 kernel'</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(temp_open, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>lpf_kernel <span class="op">=</span> np.ones((<span class="dv">5</span>,<span class="dv">5</span>), np.float32)<span class="op">/</span><span class="dv">25</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>lpf_ex <span class="op">=</span> cv2.filter2D(open_ex, <span class="op">-</span><span class="dv">1</span>, lpf_kernel)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>temp_lpf <span class="op">=</span>  mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>temp_lpf[lpf_ex <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].imshow(lpf_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">'Low-pass filter with 5x5 kernel'</span>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">1</span>].imshow(temp_lpf, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>eroded <span class="op">=</span> cv2.erode(lpf_ex, np.ones((<span class="dv">3</span>,<span class="dv">3</span>), np.uint8), iterations<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>temp_er <span class="op">=</span> mapdata[<span class="dv">2500</span>:<span class="dv">3500</span>, <span class="dv">2000</span>:<span class="dv">3000</span>,:].copy()</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>temp_er[eroded <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">0</span>].imshow(eroded, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">0</span>].set_title(<span class="st">'Erosion with 3x3 kernel'</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].imshow(temp_er, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Visually compare the different skeletonizing methods: <code>skimage.morphology.skeletonize</code>, <code>skimage.morphology.thin</code> and <code>skimage.morphology.medial_axis</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>skeletonized <span class="op">=</span> skeletonize(eroded[<span class="dv">350</span>:<span class="op">-</span><span class="dv">350</span>, <span class="dv">350</span>:<span class="op">-</span><span class="dv">350</span>])</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>thinned <span class="op">=</span> thin(eroded[<span class="dv">350</span>:<span class="op">-</span><span class="dv">350</span>, <span class="dv">350</span>:<span class="op">-</span><span class="dv">350</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>med_axis <span class="op">=</span> medial_axis(eroded[<span class="dv">350</span>:<span class="op">-</span><span class="dv">350</span>, <span class="dv">350</span>:<span class="op">-</span><span class="dv">350</span>])</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>), dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs.flatten(): a.axis(<span class="st">'off'</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].imshow(eroded[<span class="dv">350</span>:<span class="op">-</span><span class="dv">350</span>, <span class="dv">350</span>:<span class="op">-</span><span class="dv">350</span>], interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Original'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].imshow(skeletonized, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Skeletonized'</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(thinned, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Thinned'</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(med_axis, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'Medial axis'</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Seems that no major differences between the methods,</p>
</section>
<section id="water-bodies" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="water-bodies"><span class="header-section-number">2.5</span> Water bodies</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>waterbodies <span class="op">=</span> np.empty(data.shape)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>waterbodies[data<span class="op">==</span><span class="dv">5</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>waterbodies <span class="op">=</span> waterbodies[<span class="dv">1500</span>:<span class="dv">2500</span>, <span class="dv">1000</span>:<span class="dv">2000</span>]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>waterbodies <span class="op">=</span> waterbodies.astype(np.uint8)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>tempmap <span class="op">=</span> mapdata[<span class="dv">1500</span>:<span class="dv">2500</span>, <span class="dv">1000</span>:<span class="dv">2000</span>,:].copy()</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>tempmap[waterbodies <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(waterbodies)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(tempmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.image.AxesImage&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-22-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">3</span>,<span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">300</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">12</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs.flatten(): a.axis(<span class="st">'off'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].imshow(waterbodies, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'Raw image'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'Raw map'</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].imshow(tempmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> np.ones((<span class="dv">11</span>,<span class="dv">11</span>), np.uint8)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>open_ex <span class="op">=</span> cv2.morphologyEx(waterbodies, cv2.MORPH_OPEN, kernel)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].imshow(open_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Opening with 11x11 kernel'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>temp_open <span class="op">=</span> mapdata[<span class="dv">1500</span>:<span class="dv">2500</span>, <span class="dv">1000</span>:<span class="dv">2000</span>,:].copy()</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>temp_open[open_ex <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].imshow(temp_open, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>lpf_kernel <span class="op">=</span> np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.float32)<span class="op">/</span><span class="dv">49</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>lpf_ex <span class="op">=</span> cv2.filter2D(open_ex, <span class="op">-</span><span class="dv">1</span>, lpf_kernel)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].imshow(lpf_ex, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">'Low-pass filter with 9x9 kernel'</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>temp_lpf <span class="op">=</span> mapdata[<span class="dv">1500</span>:<span class="dv">2500</span>, <span class="dv">1000</span>:<span class="dv">2000</span>,:].copy()</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>temp_lpf[lpf_ex <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>,<span class="dv">1</span>].imshow(temp_lpf, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="all-together" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="all-together"><span class="header-section-number">2.6</span> All together:</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_postproc_chain(inpath, outpath):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(inpath) <span class="im">as</span> src:</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> src.read()[<span class="dv">0</span>]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        prof <span class="op">=</span> src.profile</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    fields <span class="op">=</span> np.where((data<span class="op">==</span><span class="dv">1</span>) <span class="op">|</span> (data<span class="op">==</span><span class="dv">4</span>), <span class="dv">1</span>, <span class="dv">0</span>).astype(np.uint8)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    mires <span class="op">=</span> np.where((data<span class="op">==</span><span class="dv">2</span>) <span class="op">|</span> (data<span class="op">==</span><span class="dv">4</span>), <span class="dv">1</span>, <span class="dv">0</span>).astype(np.uint8)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    roads <span class="op">=</span> np.where(data<span class="op">==</span><span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>).astype(np.uint8)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    watercourses <span class="op">=</span> np.where(data<span class="op">==</span><span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>).astype(np.uint8)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    waterbodies <span class="op">=</span> np.where(data<span class="op">==</span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>).astype(np.uint8)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    er_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_CROSS, (<span class="dv">11</span>,<span class="dv">11</span>))</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    dil_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_RECT, (<span class="dv">11</span>,<span class="dv">11</span>))</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    fields <span class="op">=</span> cv2.erode(fields, er_kernel)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    fields <span class="op">=</span> cv2.morphologyEx(fields, cv2.MORPH_OPEN, np.ones((<span class="dv">3</span>,<span class="dv">3</span>)))</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    fields <span class="op">=</span> cv2.dilate(fields, dil_kernel)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    fields <span class="op">=</span> cv2.filter2D(fields, <span class="op">-</span><span class="dv">1</span>,  np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.float32)<span class="op">/</span><span class="dv">49</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    mires <span class="op">=</span> cv2.erode(mires, er_kernel)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    mires <span class="op">=</span> cv2.morphologyEx(mires, cv2.MORPH_OPEN, np.ones((<span class="dv">3</span>,<span class="dv">3</span>)))</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    mires <span class="op">=</span> cv2.dilate(mires, dil_kernel)    </span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    mires <span class="op">=</span> cv2.filter2D(mires, <span class="op">-</span><span class="dv">1</span>,  np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.float32)<span class="op">/</span><span class="dv">49</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    roads <span class="op">=</span> cv2.morphologyEx(roads, cv2.MORPH_CLOSE, np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.uint8))</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    roads <span class="op">=</span> cv2.filter2D(roads, <span class="op">-</span><span class="dv">1</span>, np.ones((<span class="dv">5</span>,<span class="dv">5</span>), np.float32)<span class="op">/</span><span class="dv">25</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    watercourses <span class="op">=</span> cv2.morphologyEx(watercourses, cv2.MORPH_CLOSE, np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.uint8))</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    watercourses <span class="op">=</span> cv2.filter2D(watercourses, <span class="op">-</span><span class="dv">1</span>, np.ones((<span class="dv">5</span>,<span class="dv">5</span>), np.float32)<span class="op">/</span><span class="dv">25</span>)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    waterbodies <span class="op">=</span> cv2.morphologyEx(waterbodies, cv2.MORPH_OPEN, np.ones((<span class="dv">11</span>,<span class="dv">11</span>), np.uint8))</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    waterbodies <span class="op">=</span> cv2.filter2D(waterbodies, <span class="op">-</span><span class="dv">1</span>,  np.ones((<span class="dv">7</span>,<span class="dv">7</span>), np.float32)<span class="op">/</span><span class="dv">49</span>)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    prof.update({<span class="st">'count'</span>: <span class="dv">5</span>})</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Roads split these classes into multiple geometries</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    fields[roads <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    mires[roads <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clip with waterbodies also</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    fields[waterbodies <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    mires[waterbodies <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(outpath, <span class="st">'w'</span>, <span class="op">**</span>prof) <span class="im">as</span> dest:</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>        dest.write(fields, <span class="dv">1</span>)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>        dest.write(mires, <span class="dv">2</span>)</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>        dest.write(roads, <span class="dv">3</span>)</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>        dest.write(watercourses, <span class="dv">4</span>)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>        dest.write(waterbodies, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>indir <span class="op">=</span> Path(<span class="st">'../results/raw/'</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>outdir <span class="op">=</span> Path(<span class="st">'../results/processed/'</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> tqdm(os.listdir(indir)):</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    run_postproc_chain(indir<span class="op">/</span>f, outdir<span class="op">/</span>f)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>val_indir <span class="op">=</span> Path(<span class="st">'../data/reference_masks/'</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>val_outdir <span class="op">=</span> Path(<span class="st">'../data/reference_masks/postproc'</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> tqdm([<span class="st">'val_mask_1965.tif'</span>, <span class="st">'val_mask_1984.tif'</span>]):</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    run_postproc_chain(val_indir<span class="op">/</span>f, val_outdir<span class="op">/</span>f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████████████████████████████████████████████████████████████████████████████| 18/18 [01:23&lt;00:00,  4.64s/it]
100%|████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:03&lt;00:00,  1.60s/it]</code></pre>
</div>
</div>
</section>
</section>
<section id="evaluating-post-processed-test-set" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Evaluating post-processed test set</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'../results/processed/213405_1965.tif'</span>) <span class="im">as</span> pred_src:</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    bounds_test <span class="op">=</span> pred_src.bounds</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    preds_65_proc_raw, tfm_65 <span class="op">=</span> rio_mask.mask(pred_src, [box(<span class="op">*</span>bounds_test).intersection(box(<span class="op">*</span>bounds_65))], crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>preds_65_proc <span class="op">=</span> np.zeros((preds_65_proc_raw.shape[<span class="dv">1</span>], preds_65_proc_raw.shape[<span class="dv">2</span>]))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>preds_65_proc[preds_65_proc_raw[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>preds_65_proc[preds_65_proc_raw[<span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>preds_65_proc[preds_65_proc_raw[<span class="dv">2</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>preds_65_proc[preds_65_proc_raw[<span class="dv">3</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>preds_65_proc[preds_65_proc_raw[<span class="dv">4</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> colors</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> colors.ListedColormap([<span class="st">'white'</span>, <span class="st">'tab:orange'</span>, <span class="st">'tab:grey'</span>, <span class="st">'tab:red'</span>, <span class="st">'tab:cyan'</span>, <span class="st">'tab:blue'</span>])</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>bounds<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> colors.BoundaryNorm(bounds, cmap.N)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(test_mask_65, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span>cmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Targets 65'</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(preds_65_proc, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span>cmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Processed predictions 65'</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'../results/processed/213405_1984.tif'</span>) <span class="im">as</span> pred_src:</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    bounds_test <span class="op">=</span> pred_src.bounds</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    preds_84_proc_raw, tfm_84 <span class="op">=</span> rio_mask.mask(pred_src, [box(<span class="op">*</span>bounds_test).intersection(box(<span class="op">*</span>bounds_84))], crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>preds_84_proc <span class="op">=</span> np.zeros((preds_84_proc_raw.shape[<span class="dv">1</span>], preds_84_proc_raw.shape[<span class="dv">2</span>]))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>preds_84_proc[preds_84_proc_raw[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>preds_84_proc[preds_84_proc_raw[<span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>preds_84_proc[preds_84_proc_raw[<span class="dv">2</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>preds_84_proc[preds_84_proc_raw[<span class="dv">3</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>preds_84_proc[preds_84_proc_raw[<span class="dv">4</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(test_mask_84, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span>cmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Targets 84'</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(preds_84_proc, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">5</span>, cmap<span class="op">=</span>cmap, interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Processed predictions 84'</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Evaluate post-processed predictions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> [<span class="st">'Fields'</span>, <span class="st">'Mires'</span>, <span class="st">'Roads'</span>, <span class="st">'Watercourses'</span>, <span class="st">'Water bodies'</span>]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>dices_65 <span class="op">=</span> []</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>dices_84 <span class="op">=</span> []</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>ious_65 <span class="op">=</span> []</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>ious_84 <span class="op">=</span> []</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>pres_65 <span class="op">=</span> []</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>pres_84 <span class="op">=</span> []</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>recs_65 <span class="op">=</span> []</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>recs_84 <span class="op">=</span> []</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">5</span>):</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    dice_65 <span class="op">=</span> dice(test_mask_65, preds_65_proc, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    dice_84 <span class="op">=</span> dice(test_mask_84, preds_84_proc, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    dices_65.append(dice_65)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    dices_84.append(dice_84)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    iou_65 <span class="op">=</span> jaccard(test_mask_65, preds_65_proc, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    iou_84 <span class="op">=</span> jaccard(test_mask_84, preds_84_proc, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    ious_65.append(iou_65)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    ious_84.append(iou_84)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    pre_65 <span class="op">=</span> pre(test_mask_65, preds_65_proc, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    pre_84 <span class="op">=</span> pre(test_mask_84, preds_84_proc, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    pres_65.append(pre_65)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    pres_84.append(pre_84)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    rec_65 <span class="op">=</span> rec(test_mask_65, preds_65_proc, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    rec_84 <span class="op">=</span> rec(test_mask_84, preds_84_proc, c<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    recs_65.append(rec_65)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    recs_84.append(rec_84)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Results for class </span><span class="sc">{</span>classes[c]<span class="sc">}</span><span class="ss">:'</span>)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Dice: 65 map: </span><span class="sc">{</span>dice_65<span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span>dice_84<span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(dice_65<span class="op">+</span>dice_84)<span class="op">/</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Jaccard: 65 map: </span><span class="sc">{</span>iou_65<span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span>iou_84<span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(iou_65<span class="op">+</span>iou_84)<span class="op">/</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Precision: 65 map: </span><span class="sc">{</span>pre_65<span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span>pre_84<span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(pre_65<span class="op">+</span>pre_84)<span class="op">/</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Recall: 65 map: </span><span class="sc">{</span>rec_65<span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span>rec_84<span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(rec_65<span class="op">+</span>rec_84)<span class="op">/</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ch">\n</span><span class="ss">'</span>)    </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Overall results:'</span>)</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Dice: 65 map: </span><span class="sc">{</span><span class="bu">sum</span>(dices_65)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span><span class="bu">sum</span>(dices_84)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(<span class="bu">sum</span>(dices_65)<span class="op">+</span><span class="bu">sum</span>(dices_84))<span class="op">/</span><span class="dv">10</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Jaccard: 65 map: </span><span class="sc">{</span><span class="bu">sum</span>(ious_65)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span><span class="bu">sum</span>(ious_84)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(<span class="bu">sum</span>(ious_65)<span class="op">+</span><span class="bu">sum</span>(ious_84))<span class="op">/</span><span class="dv">10</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Precision: 65 map: </span><span class="sc">{</span><span class="bu">sum</span>(pres_65)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span><span class="bu">sum</span>(pres_84)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(<span class="bu">sum</span>(pres_65)<span class="op">+</span><span class="bu">sum</span>(pres_84))<span class="op">/</span><span class="dv">10</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Recall: 65 map: </span><span class="sc">{</span><span class="bu">sum</span>(recs_65)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, 84 map: </span><span class="sc">{</span><span class="bu">sum</span>(recs_84)<span class="op">/</span><span class="dv">5</span><span class="sc">:.3f}</span><span class="ss">, overall </span><span class="sc">{</span>(<span class="bu">sum</span>(recs_65)<span class="op">+</span><span class="bu">sum</span>(recs_84))<span class="op">/</span><span class="dv">10</span><span class="sc">:.3f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Results for class Fields:
Dice: 65 map: 0.931, 84 map: 0.934, overall 0.933
Jaccard: 65 map: 0.872, 84 map: 0.876, overall 0.874
Precision: 65 map: 0.909, 84 map: 0.914, overall 0.912
Recall: 65 map: 0.955, 84 map: 0.955, overall 0.955

Results for class Mires:
Dice: 65 map: 0.878, 84 map: 0.823, overall 0.850
Jaccard: 65 map: 0.783, 84 map: 0.699, overall 0.741
Precision: 65 map: 0.867, 84 map: 0.835, overall 0.851
Recall: 65 map: 0.889, 84 map: 0.810, overall 0.850

Results for class Roads:
Dice: 65 map: 0.868, 84 map: 0.816, overall 0.842
Jaccard: 65 map: 0.767, 84 map: 0.689, overall 0.728
Precision: 65 map: 0.817, 84 map: 0.718, overall 0.767
Recall: 65 map: 0.926, 84 map: 0.945, overall 0.935

Results for class Watercourses:
Dice: 65 map: 0.755, 84 map: 0.742, overall 0.749
Jaccard: 65 map: 0.607, 84 map: 0.590, overall 0.598
Precision: 65 map: 0.691, 84 map: 0.650, overall 0.671
Recall: 65 map: 0.832, 84 map: 0.864, overall 0.848

Results for class Water bodies:
Dice: 65 map: 0.988, 84 map: 0.985, overall 0.986
Jaccard: 65 map: 0.975, 84 map: 0.971, overall 0.973
Precision: 65 map: 0.992, 84 map: 0.986, overall 0.989
Recall: 65 map: 0.983, 84 map: 0.984, overall 0.984

Overall results:
Dice: 65 map: 0.884, 84 map: 0.860, overall 0.872
Jaccard: 65 map: 0.801, 84 map: 0.765, overall 0.783
Precision: 65 map: 0.855, 84 map: 0.821, overall 0.838
Recall: 65 map: 0.917, 84 map: 0.911, overall 0.914</code></pre>
</div>
</div>
</section>
<section id="generate-polygon-and-line-data" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Generate polygon and line data</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> centerline.geometry <span class="im">import</span> Centerline</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>tqdm.pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For roads and watercourses, raster data is not that useful. These classes are converted into line geometries using the following steps:</p>
<ol type="1">
<li>Skeletonize the rasters</li>
<li>Polygonize the skeletonized rasters</li>
<li>Buffer these polygons by 10 meters and merge touching polygons</li>
<li>Erode these polygons by 10 meters</li>
<li>Use <code>centerline</code> library to convert polygons into line geometries</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ex_fn <span class="op">=</span> <span class="st">'../results/processed/213411_1965.tif'</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(ex_fn) <span class="im">as</span> src:</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    road_data <span class="op">=</span> src.read(<span class="dv">3</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    ww_data <span class="op">=</span> src.read(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="roads-1" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="roads-1"><span class="header-section-number">4.1</span> Roads</h2>
<p>Skeletonizing.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>), dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(road_data, cmap<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Processed rasters'</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(skeletonize(cv2.erode(road_data, np.ones((<span class="dv">3</span>,<span class="dv">3</span>), np.uint8), iterations<span class="op">=</span><span class="dv">1</span>)), cmap<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Then data are converted to polygons, buffered and merged, and <code>centerline.geometry.Centerline</code> is used to get line geometries from the data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>polys <span class="op">=</span> gpd.read_file(<span class="st">'../results/polygons/roads/213411_1965.geojson'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> gpd.read_file(<span class="st">'../results/lines/roads/213411_1965.geojson'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>lines.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-33-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>As there were still some faulty locations (remnants from red numbers, for instance), we removed all line segments that were less than 100 meters long.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>lines[lines.length <span class="op">&gt;</span> <span class="dv">100</span>].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-34-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="watercourses-1" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="watercourses-1"><span class="header-section-number">4.2</span> Watercourses</h2>
<p>Skeletonizing</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>), dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(ww_data, cmap<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Processed rasters'</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(skeletonize(cv2.erode(ww_data, np.ones((<span class="dv">3</span>,<span class="dv">3</span>), np.uint8), iterations<span class="op">=</span><span class="dv">1</span>)), cmap<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>polys <span class="op">=</span> gpd.read_file(<span class="st">'../results/polygons/watercourses/213411_1965.geojson'</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> gpd.read_file(<span class="st">'../results/lines/watercourses/213411_1965.geojson'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>lines.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-36-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="compare-predicted-and-annotated-total-area-and-length" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Compare predicted and annotated total area and length</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>respath <span class="op">=</span> Path(<span class="st">'../results/processed/'</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> os.listdir(respath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> centerline.geometry <span class="im">import</span> Centerline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simplify_lines(row):</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> shapely.ops.linemerge(row).simplify(<span class="dv">1</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> row.simplify(<span class="dv">1</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_processing_chain(f, data_dir, skel_dir, poly_dir, line_dir, target_class):</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Processing file </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(data_dir<span class="op">/</span>f) <span class="im">as</span> src:</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        prof <span class="op">=</span> src.profile</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> np.where(src.read()[<span class="dv">0</span>] <span class="op">==</span> target_class, <span class="dv">1</span>, <span class="dv">0</span>).astype(np.uint8)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> np.zeros(im.shape)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> cv2.erode(im, np.ones((<span class="dv">3</span>,<span class="dv">3</span>), np.uint8), iterations<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    skeletonized <span class="op">=</span> skeletonize(im)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    prof.update({<span class="st">'count'</span>:<span class="dv">1</span>})</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(skel_dir<span class="op">/</span>f, <span class="st">'w'</span>, <span class="op">**</span>prof) <span class="im">as</span> dest:</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        dest.write(skeletonized[<span class="va">None</span>])</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rio.<span class="bu">open</span>(skel_dir<span class="op">/</span>f) <span class="im">as</span> src:</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> im <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> ({<span class="st">'properties'</span>: {<span class="st">'raster_val'</span>: v}, <span class="st">'geometry'</span>: s}</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">for</span> i, (s, v) <span class="kw">in</span> <span class="bu">enumerate</span>(features.shapes(im,mask<span class="op">=</span>mask,transform<span class="op">=</span>src.transform)))</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> fiona.<span class="bu">open</span>(<span class="bu">str</span>(poly_dir<span class="op">/</span>f.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>)), </span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'w'</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>,</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>                        crs<span class="op">=</span><span class="st">'EPSG:3067'</span>,</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>                        schema<span class="op">=</span>{<span class="st">'properties'</span>: [(<span class="st">'raster_val'</span>, <span class="st">'int'</span>)],</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'geometry'</span>: <span class="st">'Polygon'</span>}) <span class="im">as</span> dst:</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>            dst.writerecords(results)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    polys <span class="op">=</span> gpd.read_file(poly_dir<span class="op">/</span>f.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>))</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    polys[<span class="st">'geometry'</span>] <span class="op">=</span> polys.geometry.<span class="bu">buffer</span>(<span class="dv">10</span>)</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    union_geoms <span class="op">=</span> polys.geometry.unary_union</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>    union_gdf <span class="op">=</span> gpd.GeoDataFrame({<span class="st">'geometry'</span>: union_geoms}, crs<span class="op">=</span>polys.crs)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>    union_gdf[<span class="st">'geometry'</span>] <span class="op">=</span> union_gdf.geometry.<span class="bu">buffer</span>(<span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>    union_gdf[<span class="st">'geometry'</span>] <span class="op">=</span> union_gdf.geometry.simplify(<span class="dv">1</span>)</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>    union_gdf.to_file(poly_dir<span class="op">/</span>f.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>))</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> union_gdf.copy()</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>    lines[<span class="st">'geometry'</span>] <span class="op">=</span> lines.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: Centerline(row))</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>    lines[<span class="st">'geometry'</span>] <span class="op">=</span> lines.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> row: simplify_lines(row))</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>    lines.to_file(line_dir<span class="op">/</span>f.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> Path(<span class="st">'../data/reference_masks/'</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>skel_dir <span class="op">=</span> Path(<span class="st">'../data/reference_masks/skel'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>poly_dir <span class="op">=</span> Path(<span class="st">'../data/reference_masks/polydata/'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>line_dir <span class="op">=</span> Path(<span class="st">'../data/reference_masks/linedata/'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">#run_processing_chain('val_mask_1965.tif', data_dir, skel_dir/'roads', poly_dir/'roads', line_dir/'roads', 3)</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#run_processing_chain('val_mask_1965.tif', data_dir, skel_dir/'watercourses', poly_dir/'watercourses', </span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                     line_dir/'watercourses', 4)</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">#run_processing_chain('val_mask_1984.tif', data_dir, skel_dir/'roads', poly_dir/'roads', line_dir/'roads', 3)</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#run_processing_chain('val_mask_1984.tif', data_dir, skel_dir/'watercourses', poly_dir/'watercourses', </span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                     line_dir/'watercourses', 4)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Processing file val_mask_1984.tif
Processing file val_mask_1984.tif</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>respath <span class="op">=</span> Path(<span class="st">'../results/processed/'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>polypath <span class="op">=</span> Path(<span class="st">'../results/validation_polys/'</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>refpath <span class="op">=</span> Path(<span class="st">'../data/reference_masks/'</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>linepath <span class="op">=</span> Path(<span class="st">'../results/lines/'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>ref_linepath <span class="op">=</span> Path(<span class="st">'../data/reference_masks/linedata/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fields-1" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="fields-1"><span class="header-section-number">5.1</span> Fields</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> [<span class="st">'213405_1965.tif'</span>, <span class="st">'213405_1984.tif'</span>]:</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    polygonize(respath<span class="op">/</span>r, polypath<span class="op">/</span><span class="st">'fields'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">1</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> [<span class="st">'val_mask_1965.tif'</span>, <span class="st">'val_mask_1984.tif'</span>]:</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    polygonize(refpath<span class="op">/</span><span class="st">'postproc'</span><span class="op">/</span>r, refpath<span class="op">/</span><span class="st">'polydata/fields'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">1</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>), dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs: </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    a.set_xticks([])</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    a.set_yticks([])</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>pred_fields_65 <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'fields/213405_1965.geojson'</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>ref_fields_65 <span class="op">=</span> gpd.read_file(refpath<span class="op">/</span><span class="st">'polydata/fields/val_mask_1965.geojson'</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>pred_fields_65 <span class="op">=</span> pred_fields_65.clip(box(<span class="op">*</span>ref_fields_65.total_bounds))</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>pred_fields_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>]).set_title(<span class="st">'Predicted 1965'</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>ref_fields_65 <span class="op">=</span> ref_fields_65.clip(box(<span class="op">*</span>pred_fields_65.total_bounds))</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>ref_fields_65.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>]).set_title(<span class="st">'Annotated 1965'</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>pred_fields_84 <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'fields/213405_1984.geojson'</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>ref_fields_84 <span class="op">=</span> gpd.read_file(refpath<span class="op">/</span><span class="st">'polydata/fields/val_mask_1984.geojson'</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>pred_fields_84 <span class="op">=</span> pred_fields_84.clip(box(<span class="op">*</span>ref_fields_84.total_bounds))</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>pred_fields_84.plot(ax<span class="op">=</span>axs[<span class="dv">2</span>]).set_title(<span class="st">'Predicted 1984'</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>ref_fields_84 <span class="op">=</span> ref_fields_84.clip(box(<span class="op">*</span>pred_fields_84.total_bounds))</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>ref_fields_84.plot(ax<span class="op">=</span>axs[<span class="dv">3</span>]).set_title(<span class="st">'Annotated 1984'</span>)</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted field area in 1965: </span><span class="sc">{</span>pred_fields_65<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated field area in 1965: </span><span class="sc">{</span>ref_fields_65<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km²: </span><span class="sc">{</span>(pred_fields_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> ref_fields_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(pred_fields_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> ref_fields_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="op">/</span>(ref_fields_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted field area in 1965: 2.072 km²
Total annotated field area in 1965: 2.102 km²
Difference in km²: -0.030 km²
%-difference: -1.409 %</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted field area in 1984: </span><span class="sc">{</span>pred_fields_84<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated field area in 1984: </span><span class="sc">{</span>ref_fields_84<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km²: </span><span class="sc">{</span>(pred_fields_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> ref_fields_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(pred_fields_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> ref_fields_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="op">/</span>(ref_fields_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted field area in 1984: 1.749 km²
Total annotated field area in 1984: 1.769 km²
Difference in km²: -0.020 km²
%-difference: -1.120 %</code></pre>
</div>
</div>
</section>
<section id="mires-1" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="mires-1"><span class="header-section-number">5.2</span> Mires</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> [<span class="st">'213405_1965.tif'</span>, <span class="st">'213405_1984.tif'</span>]:</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    polygonize(respath<span class="op">/</span>r, polypath<span class="op">/</span><span class="st">'mires'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">2</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> [<span class="st">'val_mask_1965.tif'</span>, <span class="st">'val_mask_1984.tif'</span>]:</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    polygonize(refpath<span class="op">/</span><span class="st">'postproc'</span><span class="op">/</span>r, refpath<span class="op">/</span><span class="st">'polydata/mires'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">2</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>), dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs: </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    a.set_xticks([])</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    a.set_yticks([])</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>pred_mires_65 <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'mires/213405_1965.geojson'</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>ref_mires_65 <span class="op">=</span> gpd.read_file(refpath<span class="op">/</span><span class="st">'polydata/mires/val_mask_1965.geojson'</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>pred_mires_65 <span class="op">=</span> pred_mires_65.clip(box(<span class="op">*</span>ref_mires_65.total_bounds))</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>pred_mires_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>]).set_title(<span class="st">'Predicted 1965'</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>ref_mires_65 <span class="op">=</span> ref_mires_65.clip(box(<span class="op">*</span>pred_mires_65.total_bounds))</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>ref_mires_65.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>]).set_title(<span class="st">'Annotated 1965'</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>pred_mires_84 <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'mires/213405_1984.geojson'</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>ref_mires_84 <span class="op">=</span> gpd.read_file(refpath<span class="op">/</span><span class="st">'polydata/mires/val_mask_1984.geojson'</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>pred_mires_84 <span class="op">=</span> pred_mires_84.clip(box(<span class="op">*</span>ref_mires_84.total_bounds))</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>pred_mires_84.plot(ax<span class="op">=</span>axs[<span class="dv">2</span>]).set_title(<span class="st">'Predicted 1984'</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>ref_mires_84 <span class="op">=</span> ref_mires_84.clip(box(<span class="op">*</span>pred_mires_84.total_bounds))</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>ref_mires_84.plot(ax<span class="op">=</span>axs[<span class="dv">3</span>]).set_title(<span class="st">'Annotated 1984'</span>)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted mire area in 1965: </span><span class="sc">{</span>pred_mires_65<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated mire area in 1965: </span><span class="sc">{</span>ref_mires_65<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km²: </span><span class="sc">{</span>(pred_mires_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> ref_mires_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(pred_mires_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> ref_mires_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="op">/</span>(ref_mires_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted mire area in 1965: 5.789 km²
Total annotated mire area in 1965: 5.919 km²
Difference in km²: -0.129 km²
%-difference: -2.182 %</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted mire area in 1984: </span><span class="sc">{</span>pred_mires_84<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated mire area in 1984: </span><span class="sc">{</span>ref_mires_84<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km²: </span><span class="sc">{</span>(pred_mires_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> ref_mires_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(pred_mires_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> ref_mires_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="op">/</span>(ref_mires_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted mire area in 1984: 5.804 km²
Total annotated mire area in 1984: 6.001 km²
Difference in km²: -0.196 km²
%-difference: -3.270 %</code></pre>
</div>
</div>
</section>
<section id="roads-2" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="roads-2"><span class="header-section-number">5.3</span> Roads</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>), dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs: </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    a.set_xticks([])</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    a.set_yticks([])</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>pred_roads_65 <span class="op">=</span> gpd.read_file(linepath<span class="op">/</span><span class="st">'roads/213405_1965.geojson'</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>ref_roads_65 <span class="op">=</span> gpd.read_file(ref_linepath<span class="op">/</span><span class="st">'roads/val_mask_1965.geojson'</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>pred_roads_65 <span class="op">=</span> pred_roads_65.clip(box(<span class="op">*</span>ref_roads_65.total_bounds))</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>pred_roads_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>]).set_title(<span class="st">'Predicted 1965'</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>ref_roads_65 <span class="op">=</span> ref_roads_65.clip(box(<span class="op">*</span>pred_roads_65.total_bounds))</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>ref_roads_65.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>]).set_title(<span class="st">'Annotated 1965'</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>pred_roads_84 <span class="op">=</span> gpd.read_file(linepath<span class="op">/</span><span class="st">'roads/213405_1984.geojson'</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>ref_roads_84 <span class="op">=</span> gpd.read_file(ref_linepath<span class="op">/</span><span class="st">'roads/val_mask_1984.geojson'</span>)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>pred_roads_84 <span class="op">=</span> pred_roads_84.clip(box(<span class="op">*</span>ref_roads_84.total_bounds))</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>pred_roads_84.plot(ax<span class="op">=</span>axs[<span class="dv">2</span>]).set_title(<span class="st">'Predicted 1984'</span>)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>ref_roads_84 <span class="op">=</span> ref_roads_84.clip(box(<span class="op">*</span>pred_roads_84.total_bounds))</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>ref_roads_84.plot(ax<span class="op">=</span>axs[<span class="dv">3</span>]).set_title(<span class="st">'Annotated 1984'</span>)</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-50-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted road length in 1965: </span><span class="sc">{</span>pred_roads_65<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated road length in 1965: </span><span class="sc">{</span>ref_roads_65<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km: </span><span class="sc">{</span>(pred_roads_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span> <span class="op">-</span> ref_roads_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(pred_roads_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span> <span class="op">-</span> ref_roads_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="op">/</span>(ref_roads_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted road length in 1965: 15.759 km
Total annotated road length in 1965: 15.612 km
Difference in km: -0.147 km
%-difference: -0.943 %</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted road length in 1984: </span><span class="sc">{</span>pred_roads_84<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated road length in 1984: </span><span class="sc">{</span>ref_roads_84<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km: </span><span class="sc">{</span>(ref_roads_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span> <span class="op">-</span> pred_roads_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(ref_roads_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span> <span class="op">-</span> pred_roads_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="op">/</span>(ref_roads_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted road length in 1984: 16.832 km
Total annotated road length in 1984: 16.200 km
Difference in km: -0.632 km
%-difference: -3.900 %</code></pre>
</div>
</div>
</section>
<section id="watercourses-2" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="watercourses-2"><span class="header-section-number">5.4</span> Watercourses</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>), dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs: </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    a.set_xticks([])</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    a.set_yticks([])</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>pred_watercourses_65 <span class="op">=</span> gpd.read_file(linepath<span class="op">/</span><span class="st">'watercourses/213405_1965.geojson'</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>ref_watercourses_65 <span class="op">=</span> gpd.read_file(ref_linepath<span class="op">/</span><span class="st">'watercourses/val_mask_1965.geojson'</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>pred_watercourses_65 <span class="op">=</span> pred_watercourses_65.clip(box(<span class="op">*</span>ref_watercourses_65.total_bounds))</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>pred_watercourses_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>]).set_title(<span class="st">'Predicted 1965'</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>ref_watercourses_65 <span class="op">=</span> ref_watercourses_65.clip(box(<span class="op">*</span>pred_watercourses_65.total_bounds))</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>ref_watercourses_65.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>]).set_title(<span class="st">'Annotated 1965'</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>pred_watercourses_84 <span class="op">=</span> gpd.read_file(linepath<span class="op">/</span><span class="st">'watercourses/213405_1984.geojson'</span>)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>ref_watercourses_84 <span class="op">=</span> gpd.read_file(ref_linepath<span class="op">/</span><span class="st">'watercourses/val_mask_1984.geojson'</span>)</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>pred_watercourses_84 <span class="op">=</span> pred_watercourses_84.clip(box(<span class="op">*</span>ref_watercourses_84.total_bounds))</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>pred_watercourses_84.plot(ax<span class="op">=</span>axs[<span class="dv">2</span>]).set_title(<span class="st">'Predicted 1984'</span>)</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>ref_watercourses_84 <span class="op">=</span> ref_watercourses_84.clip(box(<span class="op">*</span>pred_watercourses_84.total_bounds))</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>ref_watercourses_84.plot(ax<span class="op">=</span>axs[<span class="dv">3</span>]).set_title(<span class="st">'Annotated 1984'</span>)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-53-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted watercourse length in 1965: </span><span class="sc">{</span>pred_watercourses_65<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated watercourse length in 1965: </span><span class="sc">{</span>ref_watercourses_65<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km: </span><span class="sc">{</span>(ref_watercourses_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span> <span class="op">-</span> pred_watercourses_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(ref_watercourses_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span> <span class="op">-</span> pred_watercourses_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="op">/</span>(ref_watercourses_65.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted watercourse length in 1965: 55.786 km
Total annotated watercourse length in 1965: 59.255 km
Difference in km: 3.469 km
%-difference: 5.854 %</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted watercourse length in 1984: </span><span class="sc">{</span>pred_watercourses_84<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated watercourse length in 1984: </span><span class="sc">{</span>ref_watercourses_84<span class="sc">.</span>length<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span><span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km: </span><span class="sc">{</span>(ref_watercourses_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span> <span class="op">-</span> pred_watercourses_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.3f}</span><span class="ss"> km'</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(ref_watercourses_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span> <span class="op">-</span> pred_watercourses_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="op">/</span>(ref_watercourses_84.length.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted watercourse length in 1984: 160.470 km
Total annotated watercourse length in 1984: 164.801 km
Difference in km: 4.332 km
%-difference: 2.628 %</code></pre>
</div>
</div>
</section>
<section id="water-bodies-1" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="water-bodies-1"><span class="header-section-number">5.5</span> Water bodies</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> [<span class="st">'213405_1965.tif'</span>, <span class="st">'213405_1984.tif'</span>]:</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    polygonize(respath<span class="op">/</span>r, polypath<span class="op">/</span><span class="st">'water_bodies'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">5</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> [<span class="st">'val_mask_1965.tif'</span>, <span class="st">'val_mask_1984.tif'</span>]:</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    polygonize(refpath<span class="op">/</span><span class="st">'postproc'</span><span class="op">/</span>r, refpath<span class="op">/</span><span class="st">'polydata/water_bodies'</span><span class="op">/</span>r.replace(<span class="st">'tif'</span>, <span class="st">'geojson'</span>), target_class<span class="op">=</span><span class="dv">5</span>, scale_factor<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>), dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> axs: </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    a.set_xticks([])</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    a.set_yticks([])</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>pred_water_bodies_65 <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'water_bodies/213405_1965.geojson'</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>ref_water_bodies_65 <span class="op">=</span> gpd.read_file(refpath<span class="op">/</span><span class="st">'polydata/water_bodies/val_mask_1965.geojson'</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>pred_water_bodies_65 <span class="op">=</span> pred_water_bodies_65.clip(box(<span class="op">*</span>ref_water_bodies_65.total_bounds))</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>pred_water_bodies_65.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>]).set_title(<span class="st">'Predicted 1965'</span>)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>ref_water_bodies_65 <span class="op">=</span> ref_water_bodies_65.clip(box(<span class="op">*</span>pred_water_bodies_65.total_bounds))</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>ref_water_bodies_65.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>]).set_title(<span class="st">'Annotated 1965'</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>pred_water_bodies_84 <span class="op">=</span> gpd.read_file(polypath<span class="op">/</span><span class="st">'water_bodies/213405_1984.geojson'</span>)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>ref_water_bodies_84 <span class="op">=</span> gpd.read_file(refpath<span class="op">/</span><span class="st">'polydata/water_bodies/val_mask_1984.geojson'</span>)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>pred_water_bodies_84 <span class="op">=</span> pred_water_bodies_84.clip(box(<span class="op">*</span>ref_water_bodies_84.total_bounds))</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>pred_water_bodies_84.plot(ax<span class="op">=</span>axs[<span class="dv">2</span>]).set_title(<span class="st">'Predicted 1984'</span>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>ref_water_bodies_84 <span class="op">=</span> ref_water_bodies_84.clip(box(<span class="op">*</span>pred_water_bodies_84.total_bounds))</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>ref_water_bodies_84.plot(ax<span class="op">=</span>axs[<span class="dv">3</span>]).set_title(<span class="st">'Annotated 1984'</span>)</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="postprocessings_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted water body area in 1965: </span><span class="sc">{</span>pred_water_bodies_65<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated water body area in 1965: </span><span class="sc">{</span>ref_water_bodies_65<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km²: </span><span class="sc">{</span>(ref_water_bodies_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> pred_water_bodies_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(ref_water_bodies_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> pred_water_bodies_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="op">/</span>(ref_water_bodies_65.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted water body area in 1965: 2.519 km²
Total annotated water body area in 1965: 2.530 km²
Difference in km²: 0.011 km²
%-difference: 0.449 %</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total predicted water body area in 1984: </span><span class="sc">{</span>pred_water_bodies_84<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total annotated water body area in 1984: </span><span class="sc">{</span>ref_water_bodies_84<span class="sc">.</span>area<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span><span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Difference in km²: </span><span class="sc">{</span>(ref_water_bodies_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> pred_water_bodies_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> km²'</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'%-difference: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(ref_water_bodies_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span> <span class="op">-</span> pred_water_bodies_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="op">/</span>(ref_water_bodies_84.area.<span class="bu">sum</span>()<span class="op">*</span><span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>)<span class="sc">:.3f}</span><span class="ss"> %'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total predicted water body area in 1984: 2.463 km²
Total annotated water body area in 1984: 2.462 km²
Difference in km²: -0.002 km²
%-difference: -0.069 %</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./train_model.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Train model</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./change_analysis.html" class="pagination-link">
        <span class="nav-page-text">Change analysis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>